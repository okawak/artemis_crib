<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.132.1">
    <meta name="generator" content="Relearn 6.0.0">
    <meta name="description" content="Up to now, we have introduced the installation and concepts of artemis.">
    <meta name="author" content="Kodai Okawa">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Example :: CRIB artemis">
    <meta name="twitter:description" content="Up to now, we have introduced the installation and concepts of artemis.">
    <meta property="og:url" content="https://okawak.github.io/artemis_crib/example/index.html">
    <meta property="og:site_name" content="CRIB artemis">
    <meta property="og:title" content="Example :: CRIB artemis">
    <meta property="og:description" content="Up to now, we have introduced the installation and concepts of artemis.">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Example :: CRIB artemis">
    <meta itemprop="description" content="Up to now, we have introduced the installation and concepts of artemis.">
    <meta itemprop="dateModified" content="2023-12-23T23:02:21+09:00">
    <meta itemprop="wordCount" content="98">
    <title>Example :: CRIB artemis</title>
    <link href="https://okawak.github.io/artemis_crib/example/index.html" rel="canonical" type="text/html" title="Example :: CRIB artemis">
    <link href="/artemis_crib/example/index.xml" rel="alternate" type="application/rss+xml" title="Example :: CRIB artemis"><link rel="icon" href="/artemis_crib/images/crib_overlay.png" type="image/png">

    <link href="/artemis_crib/css/fontawesome-all.min.css?1723613657" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/artemis_crib/css/fontawesome-all.min.css?1723613657" rel="stylesheet"></noscript>
    <link href="/artemis_crib/css/nucleus.css?1723613657" rel="stylesheet">
    <link href="/artemis_crib/css/auto-complete.css?1723613657" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/artemis_crib/css/auto-complete.css?1723613657" rel="stylesheet"></noscript>
    <link href="/artemis_crib/css/perfect-scrollbar.min.css?1723613657" rel="stylesheet">
    <link href="/artemis_crib/css/fonts.css?1723613657" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/artemis_crib/css/fonts.css?1723613657" rel="stylesheet"></noscript>
    <link href="/artemis_crib/css/theme.css?1723613657" rel="stylesheet">
    <link href="/artemis_crib/css/theme-CRIB-theme.css?1723613657" rel="stylesheet" id="R-variant-style">
    <link href="/artemis_crib/css/chroma-relearn-dark.css?1723613657" rel="stylesheet" id="R-variant-chroma-style">
    <link href="/artemis_crib/css/variant.css?1723613657" rel="stylesheet">
    <link href="/artemis_crib/css/print.css?1723613657" rel="stylesheet" media="print">
    <link href="/artemis_crib/css/format-print.css?1723613657" rel="stylesheet">
    <script src="/artemis_crib/js/variant.js?1723613657"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/okawak.github.io\/artemis_crib';
      window.index_js_url="/artemis_crib/index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'CRIB-theme', 'zen-dark', 'learn', 'relearn-dark' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
 

<script
  async
  src="https://www.googletagmanager.com/gtag/js?id=G-MZF67K577Y"
></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag() {
    dataLayer.push(arguments);
  }
  gtag("js", new Date());

  gtag("config", "G-MZF67K577Y");
</script>
 

  </head>
  <body class="mobile-support print" data-url="/artemis_crib/example/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Example</span><meta itemprop="position" content="1"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/artemis_crib/crib_parts/minor_change/index.html" title="Minor changes (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/artemis_crib/example/preparation/index.html" title="Preparation (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">Chapter 4</div>

<h1 id="example">Example</h1>

<p>Up to now, we have introduced the installation and concepts of artemis.
This chapter will show you how to analyse with artemis through practical examples; if you want to know how to use artemis, it is no problem to start reading from here.</p>

<ul class="children children-li children-sort-">
	
<li><a href="/artemis_crib/example/preparation/index.html">Preparation</a><ul>
	
<li><a href="/artemis_crib/example/preparation/basic/index.html">Basic</a></li>
<li><a href="/artemis_crib/example/preparation/tref/index.html">Tref for V1190</a></li>
<li><a href="/artemis_crib/example/preparation/ppac_calibration/index.html">PPAC calibration</a></li>
<li><a href="/artemis_crib/example/preparation/mwdc_calibration/index.html">MWDC calibration</a></li>
<li><a href="/artemis_crib/example/preparation/alpha_calibration/index.html">Alpha calibration</a></li>
<li><a href="/artemis_crib/example/preparation/mux_calibration/index.html">MUX calibration</a></li>
<li><a href="/artemis_crib/example/preparation/set_parameter/index.html">Set parameters</a></li>
<li><a href="/artemis_crib/example/preparation/git/index.html">Git</a></li></ul></li>
<li><a href="/artemis_crib/example/online_analysis/index.html">Online analysis</a><ul>
	
<li><a href="/artemis_crib/example/online_analysis/f1/index.html">F1</a></li>
<li><a href="/artemis_crib/example/online_analysis/pid/index.html">Beam PID</a></li>
<li><a href="/artemis_crib/example/online_analysis/f2/index.html">F2</a></li>
<li><a href="/artemis_crib/example/online_analysis/ppac/index.html">PPAC</a></li>
<li><a href="/artemis_crib/example/online_analysis/mwdc/index.html">MWDC</a></li>
<li><a href="/artemis_crib/example/online_analysis/telescope/index.html">Telescope</a></li>
<li><a href="/artemis_crib/example/online_analysis/f3/index.html">F3</a></li>
<li><a href="/artemis_crib/example/online_analysis/gate/index.html">Gate</a></li>
<li><a href="/artemis_crib/example/online_analysis/shift/index.html">Shifter task</a></li>
<li><a href="/artemis_crib/example/online_analysis/scaler/index.html">Scaler</a></li>
<li><a href="/artemis_crib/example/online_analysis/timestamp/index.html">Timestamp</a></li>
<li><a href="/artemis_crib/example/online_analysis/check_rawdata/index.html">Raw data checker</a></li></ul></li>
<li><a href="/artemis_crib/example/offline_analysis/index.html">Offline analysis</a><ul>
	
<li><a href="/artemis_crib/example/offline_analysis/new_processor/index.html">New processors</a></li>
<li><a href="/artemis_crib/example/offline_analysis/merge_files/index.html">Merge files</a></li>
<li><a href="/artemis_crib/example/offline_analysis/python_environment/index.html">Python environment</a></li>
<li><a href="/artemis_crib/example/offline_analysis/pyroot/index.html">pyROOT</a></li>
<li><a href="/artemis_crib/example/offline_analysis/analysis_example/index.html">Analysis example</a></li></ul></li>
<li><a href="/artemis_crib/example/simulation/index.html">MC Simulation</a><ul>
	
<li><a href="/artemis_crib/example/simulation/beam_generator/index.html">Beam Generator</a></li>
<li><a href="/artemis_crib/example/simulation/nbodyreaction/index.html">Nbody Reaction</a></li>
<li><a href="/artemis_crib/example/simulation/geometry/index.html">Geometry</a></li>
<li><a href="/artemis_crib/example/simulation/detect_particle/index.html">Detect particles</a></li>
<li><a href="/artemis_crib/example/simulation/solidangle/index.html">Solidangle</a></li></ul></li>
</ul>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 23, 2023
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Example</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="preparation">Preparation</h1>

<p>This section explain the example of preparation by using some useful macro.</p>

<ul class="children children-li children-sort-weight">
	
<li><a href="/artemis_crib/example/preparation/basic/index.html">Basic</a></li>
<li><a href="/artemis_crib/example/preparation/tref/index.html">Tref for V1190</a></li>
<li><a href="/artemis_crib/example/preparation/ppac_calibration/index.html">PPAC calibration</a></li>
<li><a href="/artemis_crib/example/preparation/mwdc_calibration/index.html">MWDC calibration</a></li>
<li><a href="/artemis_crib/example/preparation/alpha_calibration/index.html">Alpha calibration</a></li>
<li><a href="/artemis_crib/example/preparation/mux_calibration/index.html">MUX calibration</a></li>
<li><a href="/artemis_crib/example/preparation/set_parameter/index.html">Set parameters</a></li>
<li><a href="/artemis_crib/example/preparation/git/index.html">Git</a></li>
</ul>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 13, 2023
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Preparation</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="basic">Basic</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-13 by Kodai Okawa</span></span>
<p>I would now like to introduce the actual analysis using the CRIB analysis server.
There are two ways to enter the analysis server, directly or remotely via ssh.
If you come to CRIB and operate the server directly, I think it is quicker to analyse using the server
while asking the CRIB members directly as I think they are nearby.</p>
<h3 id="1-ssh-configuration">1. SSH configuration</h3>
<p>To enter the CRIB server, you need to enter the CNS network.
To do this, you need to create an account on the CNS login server.
Please contact Okawa (<a href="mailto:okawa@cns.s.u-tokyo.ac.jp" rel="external" target="_blank">okawa@cns.s.u-tokyo.ac.jp</a>) or the person responsible for CRIB <a href="https://www.cns.s.u-tokyo.ac.jp/crib/crib-new/home-en/index.html" rel="external" target="_blank">(see here)</a> and tell us that you want a login server account.</p>
<p>The CNS login server uses public key cryptography, so you need to send a shared key when you apply.
This section describes how to create the key, especially on MacOS.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="c1"># move to /Users/yourname/ (home directory)</span>
</span></span><span class="line"><span class="cl">mkdir .ssh <span class="c1"># if there is no .ssh directory</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> .ssh
</span></span><span class="line"><span class="cl">ssh-keygen</span></span></code></pre></div><p>You will be asked a number of interactive questions after this command, all of which are fine by default (Enter).
Then you will see the pair of public-key and private-key.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ls 
</span></span><span class="line"><span class="cl">id_rsa  id_rsa.pub</span></span></code></pre></div><p><code>id_rsa</code> is the private-key, and <code>id_rsa.pub</code> is the public-key.
The private key is important for security reasons and should be kept on your own computer.
Then, please send this public-key to the CNS member.
in MacOS, <code>open .</code> command will open a finder for that directory, so it is easy to attach it to an email from here.
In the email,</p>
<ul>
<li>your fullname (affiliation)</li>
<li>username</li>
<li>attached public-key</li>
</ul>
<p>are needed.</p>
<p>Next, let&rsquo;s set up multi-stage ssh.
As the login server is just a jump server, it is useful to be able to ssh to the CRIB analysis server at once!
So create the following config file. The file placed in this directory is automatically read when you ssh.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ~/.ssh
</span></span><span class="line"><span class="cl">vi config</span></span></code></pre></div>
<div class="tab-panel" data-tab-group="28deba089aa3f7551bae8dbfe08abe1b">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="sshconfig"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('28deba089aa3f7551bae8dbfe08abe1b','sshconfig')"
    >
      <span class="tab-nav-text">~/.ssh/config</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="sshconfig"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-aconf" data-lang="aconf"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nb">Host</span> login
</span></span><span class="line hl"><span class="ln"> 2</span><span class="cl">    <span class="nb">HostName</span> CNS_loginserver_hostname
</span></span><span class="line hl"><span class="ln"> 3</span><span class="cl">    <span class="nb">User</span> username
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="nb">IdentityFile</span> ~/.ssh/id_rsa
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="nb">ForWardX11Timeout</span> <span class="m">24</span>h
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nb">ControlPersist</span> <span class="m">30</span>m
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="nb">ForwardAgent</span> yes
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="nb">ControlMaster</span> auto
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="nb">ControlPath</span> ~/.ssh/mux-%r@%h:%p
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c"># any name is okay</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nb">Host</span> cribana
</span></span><span class="line hl"><span class="ln">13</span><span class="cl">    <span class="nb">HostName</span> analysisPC_hostname
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nb">User</span> crib
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nb">IdentityFile</span> ~/.ssh/id_rsa
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nb">ProxyCommand</span> ssh login nc %h %p
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nb">ForwardAgent</span> yes
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nb">ControlMaster</span> auto
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nb">ControlPath</span> ~/.ssh/mux-%r@%h:%p
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nb">ControlPersist</span> <span class="m">30</span>m</span></span></code></pre></div></div>
    </div>
  </div>
</div><p>You will be informed of the second and third lines above that we highlighted, so please change this parts.
And ask the IP address of the CRIB analysis PC to the CRIB member, and change the 13 line.</p>
<p>Then you can enter the CRIB analysis PC just by</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ssh cribana</span></span></code></pre></div><p>CRIB member will tell you the passward!</p>
<p>For the VNC server (local forwarding), please see <a href="https://okawak.github.io/artemis_crib/setting/vncserver/index.html" rel="external" target="_blank">this section</a>.</p>
<h3 id="2-your-artemis-configuration">2. your artemis configuration</h3>
<p>When you enter the CRIB computer, please check this is <code>zsh</code> shell.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; <span class="nb">echo</span> <span class="nv">$SHELL</span>
</span></span><span class="line"><span class="cl">/usr/local/bin/zsh</span></span></code></pre></div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>Currently, zsh installed locally is used. It is planned to update the OS in the future, after which it will differ from this path in the future.</p>
</div>
</div>
<p>If it is not <code>zsh</code> (like bash), please command</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; zsh</span></span></code></pre></div><p>Then you can start to configure by</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; artlogin yourname
</span></span><span class="line"><span class="cl"><span class="c1"># input your information...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; mkdir build
</span></span><span class="line"><span class="cl">&gt; <span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">&gt; cmake ..
</span></span><span class="line"><span class="cl">&gt; make -j4
</span></span><span class="line"><span class="cl">&gt; make install
</span></span><span class="line"><span class="cl">&gt; acd</span></span></code></pre></div><p>For the detail, please check <a href="https://okawak.github.io/artemis_crib/setting/new_user/index.html" rel="external" target="_blank">here</a>.</p>
<h3 id="3-basic-usage">3. basic usage</h3>
<ul>
<li>start artemis</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; acd <span class="c1"># move to your artemis work directory</span>
</span></span><span class="line"><span class="cl">&gt; a <span class="c1"># start artemis!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; a macro/macro.C <span class="c1"># run macro script</span></span></span></code></pre></div><ul>
<li>important command in the artemis console</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># read steering file</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># start event loop</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> start <span class="c1"># defined in CRIB artemis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># stop event loop</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> sus
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> stop <span class="c1"># defined in CRIB artemis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># help</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> <span class="nb">help</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># quit from artemis</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> .q</span></span></code></pre></div><ul>
<li>commands for checking histograms</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># check and move the directory</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> <span class="nb">cd</span> <span class="m">0</span> <span class="c1"># cd ID</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move to home directory in artemis</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> <span class="nb">cd</span> <span class="c1"># cd .. will work?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># draw the histograms</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> ht <span class="m">0</span> colz <span class="c1"># ht ID option</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hn colz <span class="c1"># draw the next histogram object</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hb colz <span class="c1"># draw the previous histogram object</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># divide the canvas</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> zone <span class="m">2</span> <span class="m">2</span> <span class="c1"># 2 x 2 canvas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># save and print the canvas</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> sa
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> pri</span></span></code></pre></div><ul>
<li>analize using TTree</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># check the files</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> fls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move to the created ROOT file</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> fcd <span class="m">0</span> <span class="c1"># fcd fileID</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check the all branches</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> br
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check the data members or methods</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> br branchname <span class="c1"># ex. artemis [1] br ppaca</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># the name of TTree object is &#34;tree&#34; (actually TArtTree object)</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;ppaca.fY:ppaca.fX&gt;&gt;ppaca(100,-20.,20., 100,-20.,20.)&#34;</span>,<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;colz&#34;</span><span class="o">)</span></span></span></code></pre></div><p>See <a href="https://okawak.github.io/artemis_crib/setting/artemis_commands/index.html" rel="external" target="_blank">here</a> for an example using random numbers.</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 13, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="tref-for-v1190">Tref for V1190</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>
<p>CRIB uses a multi-hit TDC called V1190 to take timing data (<a href="https://drive.google.com/file/d/1YRwkuFTjKFb5OvC1EfxYZtOGGdf-zKkS/view?usp=sharing" rel="external" target="_blank">manual</a>).
When a trigger comes into this module, it opens a window with a set time width and records the timing of the data.</p>
<p>However, even if the signal is sent at exactly the same time to the trigger, due to the uncertainty in opening that window, the resulting channel will vary.
Since absolute channel values will vary, but relative channel values for a given (especially trigger) timing will remain the same, it is necessary to subtract all data by some reference channel to achieve good timing resolution.</p>
<p>The signal that serves as the reference for that time is what we call <code>Tref</code>!
(Time reference)
Since it is essential that all events contain that data, we put the trigger signal in one of the channels and make it a Tref.</p>
<p>The &ldquo;tref&rdquo; settings are made in the following file:</p>

<div class="tab-panel" data-tab-group="fdb12a0246e1be76fb80510f430b9a3b">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringtrefyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('fdb12a0246e1be76fb80510f430b9a3b','steeringtrefyaml')"
    >
      <span class="tab-nav-text">steering/tref.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringtrefyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># J1 V1190A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">proc_tref_v1190A_j1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTimeReferenceProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># [[device] [focus] [detector] [geo] [ch]]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">RefConfig</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">  </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SegConfig</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">  </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">]</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>Parameters <code>RefConfig</code> and <code>SegConfig</code> are set using the same ID as in the <a href="https://okawak.github.io/artemis_crib/setting/map_config/index.html" rel="external" target="_blank">map file</a>.</p>
<p>The &ldquo;RefConfig&rdquo; represents the &ldquo;Tref&rdquo; signal and the &ldquo;SegConfig&rdquo; represents the V1190 module.
Therefore, the role of the processor is to subtract the &ldquo;Segconfig&rdquo; V1190 all timing signal from the &ldquo;RefConfig&rdquo; tref signal.</p>
<p>To apply this processor, add the following line to the steering file.
For example,</p>

<div class="tab-panel" data-tab-group="7da03145dd9295f4ff4a7a83cbcf0ee1">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringchkf3yaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('7da03145dd9295f4ff4a7a83cbcf0ee1','steeringchkf3yaml')"
    >
      <span class="tab-nav-text">steering/chkf3.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringchkf3yaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="cp">&amp;input</span><span class="w"> </span><span class="l">ridf/@NAME@@NUM@.ridf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="cp">&amp;output</span><span class="w"> </span><span class="l">output/chkf3@NAME@@NUM@.root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="cp">&amp;histout</span><span class="w"> </span><span class="l">output/chkf3@NAME@@NUM@.hist.root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">timer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTimerProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ridf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TRIDFEventStore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputFiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="cp">*input</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TMappingProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">tref.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">rf/rf.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">coin/coin.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">ppac/dlppac.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">ssd/f3ssd.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">outputtree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TOutputTreeProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">FileName</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="cp">*output</span></span></span></code></pre></div></div>
    </div>
  </div>
</div>
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>The tref.yaml should be written before the main processor. In this example, it is written right after TMappingProcessor, and we recommend writing it in this position.</p>
</div>
</div>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 15, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="ppac-calibration">PPAC calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-18 by Kodai Okawa</span></span>
<p>CRIB use two kinds of PPAC (Parallel-Plate Avalanche Counter), charge division method or delay-readout method.
The PPAC placed at the F1 focal plane is charge-devision type, and the parameters to be converted to position are fixed and do not need to be calibrated.
Therefore we explain the calibration method for delay-line PPAC (dl-PPAC).</p>
<h2 id="principles">Principles</h2>
<p>Here we briefly describe the principle of converting from the obtained signal to position, but for more details, see here<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p>We will discuss the x-direction because x and y is exactly same.
First, define the parameters as follows</p>
<ol>
<li>
<span class="math align-center">$k_x$</span> : convert from signal time difference to position [mm/ns]</li>
<li>
<span class="math align-center">$T_{X1},~T_{X2}$</span> : time at both ends of delay-line, measured at TDC [ns]</li>
<li>
<span class="math align-center">$T_{Xin-offset}$</span> : timing offset come from inside the chamber [ns]</li>
<li>
<span class="math align-center">$T_{Xout-offset}$</span> : timing offset come from outside the chamber [ns] (like from cabling)</li>
<li>
<span class="math align-center">$X_{offset}$</span> : geometry offset [mm]</li>
</ol>
<p>The artemis codes calculate the X position like this formula (see <a href="https://github.com/artemis-dev/artemis/blob/develop/artemis-share/src/ppac/TPPACProcessor.cc" rel="external" target="_blank">TPPACProcessor.cc</a>).</p>

<span class="math align-center">$$ X~\mathrm{[mm]} = k_x\left( \frac{T_{X1} - T_{X2} + T_{Xin-offset} - T_{Xout-offset}}{2} \right) - X_{offset}$$</span>
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>Check the sign carefully! We often mistook the direction!!</p>
</div>
</div>
<h2 id="fixed-parameters">Fixed parameters</h2>
<p>The 
<span class="math align-center">$T_{X1},~T_{X2}$</span> are measured value by TDC, and 
<span class="math align-center">$k_x$</span> and 
<span class="math align-center">$T_{Xin-offset}$</span> are specific value to PPAC, so we need to care only 
<span class="math align-center">$T_{Xout-offset}$</span> and 
<span class="math align-center">$X_{offset}$</span>.

<span class="math align-center">$X_{offset}$</span> value depends on where we put the PPAC, so what we have to do is determine the line calibration parameter (
<span class="math align-center">$T_{Xout-offset}$</span>).</p>
<p>The following is a list of dl-PPAC parameters used in CRIB experiment.</p>
<table>
<thead>
<tr>
<th>PPAC ID</th>
<th>
<span class="math align-center">$k_x$</span> [mm/ns]</th>
<th>
<span class="math align-center">$k_y$</span> [mm/ns]</th>
<th>
<span class="math align-center">$T_{Xin-offset}$</span></th>
<th>
<span class="math align-center">$T_{Yin-offset}$</span></th>
</tr>
</thead>
<tbody>
<tr>
<td>#2</td>
<td>1.256</td>
<td>1.256</td>
<td>0.29 mm</td>
<td>0.18 mm</td>
</tr>
<tr>
<td>#3</td>
<td>1.264</td>
<td>1.253</td>
<td>0.22 mm</td>
<td>0.30 mm</td>
</tr>
<tr>
<td>#7</td>
<td>1.240</td>
<td>1.242</td>
<td>0.92 ns</td>
<td>1.58 ns</td>
</tr>
<tr>
<td>#8</td>
<td>1.241</td>
<td>1.233</td>
<td>0.17 ns</td>
<td>0.11 ns</td>
</tr>
<tr>
<td>#9</td>
<td>1.257</td>
<td>1.257</td>
<td>0.05 mm</td>
<td>0.04 mm</td>
</tr>
<tr>
<td>#10</td>
<td>1.257</td>
<td>1.257</td>
<td>0.05 mm</td>
<td>0.04 mm</td>
</tr>
</tbody>
</table>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>Different units are used for the offset. However, since the effect of this offset is eventually absorbed to the other offset value, it is no problem to use the values if we calibrate it correctly.</p>
</div>
</div>
<h2 id="parameter-setting">Parameter setting</h2>
<p>PPAC parameters are defined in the following files</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/prm/ppac/dlppac.yaml" rel="external" target="_blank">prm/ppac/dlppac.yaml</a></li>
</ul>
<p>For example, it is like this:</p>

<div class="tab-panel" data-tab-group="894f2af8252b4f12812f4718d2829816">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmppacdlppacyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('894f2af8252b4f12812f4718d2829816','prmppacdlppacyaml')"
    >
      <span class="tab-nav-text">prm/ppac/dlppac.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmppacdlppacyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TPPACParameter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># #7 PPAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">f3bppac</span><span class="p">:</span><span class="w"> </span><span class="c"># this is the name of PPAC, should be the same name with the one in steering file!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ns2mm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.240</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.242</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">delayoffset</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">0.92</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.58</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">linecalib</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="m">1.00</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 0: no exchange, 1: X -&gt; Y, Y -&gt; X</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">exchange</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 0: no reflect, 1: X -&gt; -X</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reflectx</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geometry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">0.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">322.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TXSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">2000.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TYSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">2000.0</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><ul>
<li>
<p>ns2mm</p>
<p>This is 
<span class="math align-center">$k_x$</span> and 
<span class="math align-center">$k_y$</span> parameters -&gt; input the fixed value</p>
</li>
<li>
<p>delayoffset</p>
<p>This is 
<span class="math align-center">$T_{Xin-offset}$</span> and 
<span class="math align-center">$T_{Yin-offset}$</span> parameters -&gt; input the fixed value</p>
</li>
<li>
<p>linecalib</p>
<p>This is explained next.</p>
</li>
<li>
<p>exchange, reflectx</p>
<p>This parameter should be changed depending on the direction in which the PPAC is placed. The meanings of the parameters are given above as comments.

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>CRIB takes a coordinate system such that when viewed from downstream of the beam, the x-axis is rightward and the y-axis is upward. In other words, it takes a right-handed coordinate system with the beam as the Z-axis. While looking at the actual data, change these parameters so that the coordinate system becomes this coordinate system.</p>
</div>
</div></p>
</li>
<li>
<p>geometry</p>
<p>In the Line calibration, please set this value to (0,0).
After Line calibration, if we put the PPAC with some geometry offset, we should change this parameters.
Please be careful that the parameter will add minus this value for X and Y.
Z offset will be used for <a href="https://github.com/artemis-dev/artemis/blob/develop/artemis-share/src/ppac/TPPACProcessor.cc" rel="external" target="_blank">TPPACTrackingProcessor</a>.</p>
</li>
<li>
<p>TXSumLimit, TYSumLimit</p>
<p>Used to determine if it is a good event or not. Currently not used.</p>
</li>
</ul>
<h2 id="line-calibration">Line calibration</h2>
<p>Before starting line calibration, please make sure that map file and steering file is correctly set.
Also we need parameter file of prm/ppac/ch2ns.dat to convert TDC channel to ns unit. (already prepared I think)</p>

<pre class="mermaid align-center ">
graph LR;
    A[TDC channel] --&gt;|prm/ppac/ch2ns.dat| B[ns scale]
    B --&gt; |prm/ppac/dlppac.yaml|C{PPAC object}
</pre>
<p>When you complete the setting except for <code>linecalib</code> parameters, let&rsquo;s start calibration!
We prepared two useful macros to calibrate dl-PPAC.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/run_PPACLineCalibration.C" rel="external" target="_blank">macro/run_PPACLineCalibration.C</a> : Macro to actually execute</li>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/PPACLineCalibration.C" rel="external" target="_blank">macro/PPACLineCalibration.C</a> : Macro that actually work</li>
</ul>
<p>First, we have to prepare the data with masks on the PPAC like following picture.
This mask has holes at 12.5 mm intervals.</p>
<figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_pic.jpg" width="300">
</figure>

<p>The position of the alpha line through the central hole can be calculated and the offset adjusted to achieve that position.
The geometry inside the PPAC is as follows.
I think all PPAC geometries used by CRIB are the same.</p>
<figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_geo.png" width="700">
</figure>

<p>The parameters required to calculate the coordinates of the position are as follows.</p>
<ul>
<li>PPAC ID</li>
<li>PPAC direction (first layer is X or Y)</li>
<li>alpha source offset X</li>
<li>alpha source offset Y</li>
<li>distance between the mask and alpha source</li>
<li>reflectx in the dlppac.yaml</li>
</ul>
<p>Using these parameters, the <code>macro/PPACLineCalibration.C</code> calculate the theoretical position and how much the parameters should be moved.</p>
<h2 id="example">Example</h2>
<p>Let&rsquo;s calibrate PPACa as an example.</p>
<ul>
<li>PPAC ID : #2</li>
<li>First layer is Y</li>
<li>alpha source offset X : 0.0 mm</li>
<li>alpha source offset Y : 2.2 mm</li>
<li>distance between the mask and alpha source : 92 mm</li>
<li>reflectx : 1 (have reflection)</li>
</ul>
<p>When we set the parameter like this files, the XY figure can be obtained.</p>

<div class="tab-panel" data-tab-group="6def467ed9972da1d91823978e6fbaed">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmppacdlppacyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('6def467ed9972da1d91823978e6fbaed','prmppacdlppacyaml')"
    >
      <span class="tab-nav-text">prm/ppac/dlppac.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmppacdlppacyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TPPACParameter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># #2 PPAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">f3appac</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ns2mm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">delayoffset</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.29</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.18</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">linecalib</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">exchange</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reflectx</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geometry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">677.0</span><span class="w"> </span><span class="c"># user defined</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TXSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TYSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_before.png" width="600">
</figure>

<p>Then we can run the macro.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; acd
</span></span><span class="line"><span class="cl">&gt; vi macro/run_PPACLineCalibraion.C
</span></span><span class="line"><span class="cl"><span class="c1"># please set the parameters.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># instruction is written in this file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> .x macro/run_PPACLineCalibration.C
</span></span><span class="line"><span class="cl"><span class="c1"># -- snip --</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>cal<span class="o">)</span>  : <span class="o">(</span>-0, -0.51413<span class="o">)</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>data<span class="o">)</span> : <span class="o">(</span>0.890109, -0.274066<span class="o">)</span>
</span></span><span class="line"><span class="cl">difference             : <span class="o">(</span>0.890109, 0.240065<span class="o">)</span>
</span></span><span class="line"><span class="cl">move parameters        : <span class="o">(</span>-1.41737, 0.382269<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span></span></span></code></pre></div><p>And please input this value to the dlppac.yaml.</p>

<div class="tab-panel" data-tab-group="293df256b2db077db8202b8f92864a78">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmppacdlppacyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('293df256b2db077db8202b8f92864a78','prmppacdlppacyaml')"
    >
      <span class="tab-nav-text">prm/ppac/dlppac.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmppacdlppacyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TPPACParameter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># #2 PPAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">f3appac</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ns2mm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">delayoffset</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.29</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.18</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">linecalib</span><span class="p">:</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">      </span>- -<span class="m">1.417</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">      </span>- <span class="m">0.382</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">exchange</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reflectx</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geometry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">677.0</span><span class="w"> </span><span class="c"># user defined</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TXSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TYSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>Then you can complete the line calibration of the PPAC.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> .x macro/run_PPACLineCalibration.C
</span></span><span class="line"><span class="cl"><span class="c1"># -- snip --</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>cal<span class="o">)</span>  : <span class="o">(</span>-0, -0.51413<span class="o">)</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>data<span class="o">)</span> : <span class="o">(</span>-0.0191028, -0.571067<span class="o">)</span>
</span></span><span class="line"><span class="cl">difference             : <span class="o">(</span>-0.0191028, -0.0569366<span class="o">)</span> <span class="c1"># &lt;= almost zero!</span>
</span></span><span class="line"><span class="cl">move parameters        : <span class="o">(</span>0.0304184, -0.0906633<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span></span></span></code></pre></div><figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_after.png" width="600">
</figure>


<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>Because of the accuracy of the fitting, it does not make much sense to move the parameters any further.</p>
</div>
</div>
<p>The PPAC is then ready to be used by measuring how much offset the beamline axis has with respect to the delay-line axis at the position where the PPAC is actually placed, and putting this into the geometry parameters.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>H. Kumagai et al., Nucl. Inst. and Meth. A <strong>470</strong>, 562 (2001)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 18, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="mwdc-calibration">MWDC calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>updating&hellip;</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="alpha-calibration">Alpha calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-23 by Kodai Okawa</span></span>
<p>This is the CRIB alpha source information.
(unit: MeV)</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>alpha-2</th>
<th>alpha-3</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>4.780</td>
<td>3.148</td>
</tr>
<tr>
<td></td>
<td>5.480</td>
<td>5.462</td>
</tr>
<tr>
<td></td>
<td>5.795</td>
<td>5.771</td>
</tr>
</tbody>
</table>
<h3 id="calibration-files">calibration files</h3>
<p>SSD calibration files need to be set at <code>prm/ssd/</code> directory.
The directory structure is like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ tree -L <span class="m">2</span> prm/ssd
</span></span><span class="line"><span class="cl">prm/ssd
</span></span><span class="line"><span class="cl">â”œâ”€â”€ ch2MeV.dat <span class="c1"># test file</span>
</span></span><span class="line"><span class="cl">â”œâ”€â”€ ch2ns.dat <span class="c1"># test file</span>
</span></span><span class="line"><span class="cl">â”œâ”€â”€ f2ch2MeV.dat
</span></span><span class="line"><span class="cl">â”œâ”€â”€ f2ch2MeV_raw.dat
</span></span><span class="line"><span class="cl">â”œâ”€â”€ f2ch2ns.dat
</span></span><span class="line"><span class="cl">â”œâ”€â”€ tel1
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2MeV_dEX.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2MeV_dEX_raw.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2MeV_dEY.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2MeV_dEY_raw.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2MeV_E.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2MeV_E_raw.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2ns_dEX.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2ns_dEY.dat
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ ch2ns_E.dat
</span></span><span class="line"><span class="cl">â”‚   â””â”€â”€ tel_conf.yaml <span class="c1"># telescope configuration, explain later</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- snip --</span></span></code></pre></div><p>The <code>prm/ssd/ch2MeV.dat</code> and <code>prm/ssd/ch2ns.dat</code> are used for test, so in the beam time measurement, actually this files are not necessory.
And <code>prm/ssd/f2*</code> files are used for F2SSD calibration, and files in <code>prm/ssd/tel1/</code> directory are used for SSDs of a telescope.</p>
<p>The <code>ch2ns.dat</code> depends on TDC setting, so basically we don&rsquo;t have to care so muc
(Usually the setting (the value) is same with previous experiment.), so we have to prepare the <code>ch2MeV.dat</code> files!</p>

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>The file name need to be set like this example.
The loaded parameter file name is defined SSD steering file, and we don&rsquo;t want to change the SSD steering files so much, so please use such file names.</p>
</div>
</div>
<p>The &ldquo;ch2MeV.dat&rdquo; file format is like this:</p>

<div class="tab-panel" data-tab-group="70b1e179e25025ef3e4f56754d60e3f4">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmssdf2ch2mevdat"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('70b1e179e25025ef3e4f56754d60e3f4','prmssdf2ch2mevdat')"
    >
      <span class="tab-nav-text">prm/ssd/f2ch2MeV.dat</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmssdf2ch2mevdat"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># offset gain</span>
</span></span><span class="line"><span class="cl">1.7009  0.0173
</span></span><span class="line"><span class="cl">0.0 1.0 <span class="c1"># if there are some SSDs or strip SSD, you can add the line.</span></span></span></code></pre></div></div>
    </div>
  </div>
</div>
<span class="math align-center">$$ E~\mathrm{[MeV]} = \mathrm{offset} + \mathrm{gain} \times \mathrm{ch} $$</span><h3 id="usage">Usage</h3>
<p>We prepared useful macros to calibrate many SSDs.
Please check these for more information.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/AlphaCalibration.C" rel="external" target="_blank">macro/AlphaCalibration.C</a></li>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/run_AlphaCalibration.C" rel="external" target="_blank">macro/run_AlphaCalibraion.C</a></li>
</ul>
<p>It is sufficient to use the AlphaCalibration.C, but it is recommended to use the run_AlphaCalibration.C to keep a record of what arguments were used to calibrate.</p>
<p>After you prepared alpha calibration data and steering file (for example <code>steering/calibration.yaml</code>) to show raw data, you can use this macro.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ acd
</span></span><span class="line"><span class="cl">$ vi macro/run_AlphaCalibration.C
</span></span><span class="line"><span class="cl"><span class="c1"># please set the parameters.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># instraction is written in this file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> .x macro/run_AlphaCalibration.C</span></span></code></pre></div><p>Then the parameter file that defined at the &ldquo;run_AlphaCalibration.C&rdquo; and calibration figures will be created automatically.</p>
<p>These are example of the figures;</p>
<ul>
<li>raw fitting figure (figure/calib/tel*/ch2MeV_*/raw/)</li>
</ul>
<figure><img src="/artemis_crib/example/preparation/alpha_calibration/ex_raw.png" width="600">
</figure>

<ul>
<li>calibration line and residual figure (figure/calib/tel*/ch2MeV_*/calibration/)</li>
</ul>
<figure><img src="/artemis_crib/example/preparation/alpha_calibration/ex_cal.png" width="600">
</figure>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> fcd <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>3<span class="o">]</span> zo
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>4<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;...&#34;</span><span class="o">)</span> <span class="c1"># draw calibrated data</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>5<span class="o">]</span> gStyle-&gt;SetOptStat<span class="o">(</span>0<span class="o">)</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>6<span class="o">]</span> sa</span></span></code></pre></div><figure><img src="/artemis_crib/example/preparation/alpha_calibration/ex_all_cal.png" width="600">
</figure>


            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 23, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="mux-calibration">MUX calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>updating&hellip;</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="set-parameters">Set parameters</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>updating&hellip;</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class=" taxonomy-tags term-list cstyle  tags" title="Tags" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <ul>
    <li><a class="term-link" href="/artemis_crib/tags/need_update/index.html">Need_update</a></li>
  </ul>
</div>
            </header>

<h1 id="git">Git</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>Analysis files for each experiment are managed using <code>git</code>.
This is so that they can be quickly restored if they are all lost for some reason.</p>
<p><code>Git</code> is a bit complicated and you can commit freely if you are knowledgeable, but if you are unfamiliar with it, you don&rsquo;t have to worry too much.
The main use is that if someone creates a useful file, it will be reflected for each user as well.</p>
<p>Here is a brief description of how to use it.</p>
<h2 id="directory-structure">Directory structure</h2>
<p>In the CRIB analysis PC, we used local repository.
The files related the repository is stored here.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; <span class="nb">cd</span> ~
</span></span><span class="line"><span class="cl">&gt; tree -L <span class="m">1</span> repos/exp
</span></span><span class="line"><span class="cl">repos/exp
</span></span><span class="line"><span class="cl">â”œâ”€â”€ he6p2024.git
</span></span><span class="line"><span class="cl">â”œâ”€â”€ he6p.git
</span></span><span class="line"><span class="cl">â””â”€â”€ o14a.git
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2023/12/18 current status</span></span></span></code></pre></div>
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>Note that if you delete the files in this directory, you will lose all backups.</p>
</div>
</div>
<h2 id="basic-commands">basic commands</h2>
<p>I will describe the most commonly used commands and how to resolve conflicts.</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="online-analysis">Online analysis</h1>

<p>This section explain the example of the online analysis in the CRIB experiment.</p>

<ul class="children children-li children-sort-weight">
	
<li><a href="/artemis_crib/example/online_analysis/f1/index.html">F1</a></li>
<li><a href="/artemis_crib/example/online_analysis/pid/index.html">Beam PID</a></li>
<li><a href="/artemis_crib/example/online_analysis/f2/index.html">F2</a></li>
<li><a href="/artemis_crib/example/online_analysis/ppac/index.html">PPAC</a></li>
<li><a href="/artemis_crib/example/online_analysis/mwdc/index.html">MWDC</a></li>
<li><a href="/artemis_crib/example/online_analysis/telescope/index.html">Telescope</a></li>
<li><a href="/artemis_crib/example/online_analysis/f3/index.html">F3</a></li>
<li><a href="/artemis_crib/example/online_analysis/gate/index.html">Gate</a></li>
<li><a href="/artemis_crib/example/online_analysis/shift/index.html">Shifter task</a></li>
<li><a href="/artemis_crib/example/online_analysis/scaler/index.html">Scaler</a></li>
<li><a href="/artemis_crib/example/online_analysis/timestamp/index.html">Timestamp</a></li>
<li><a href="/artemis_crib/example/online_analysis/check_rawdata/index.html">Raw data checker</a></li>
</ul>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 13, 2023
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Online analysis</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="f1">F1</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-20 by Kodai Okawa</span></span>
<p>From here, we would like to explain in detail how to analyze the actual experiment.
We assume that you have already prepared your the analysis environment.
It is okay either your own directory or the default directory (<a href="/artemis_crib/crib_parts/environment/index.html">see CRIB configuration</a>).
If you are not ready yet, please see <a href="/artemis_crib/example/online_analysis/f1/../../preparation/basic">here</a>.</p>
<p>So let&rsquo;s start to check the data.
At the F1 focal plane, there is (charge-divition) PPAC.
The steering file to analyze f1 data is <code>chkf1.yaml</code>.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/steering/chkf1.yaml" rel="external" target="_blank">steering/chkf1.yaml</a></li>
</ul>
<p>We usually use &ldquo;chk&rdquo; (check) as a prefix of the steering files to analyze from raw binaly data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ artlogin <span class="o">(</span>username<span class="o">)</span>
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/chkf1.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res</span></span></code></pre></div><p>The important data is &ldquo;X position&rdquo; at the F1PPAC.
The histogram can be check by following step:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> sus
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>3<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> artemis
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> art::TTreeProjGroup f1check         f1_check
</span></span><span class="line"><span class="cl">    <span class="m">1</span> art::TAnalysisInfo analysisInfo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>4<span class="o">]</span> <span class="nb">cd</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>5<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> f1check
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> art::TH1FTreeProj f1ppac_X        f1ppac X
</span></span><span class="line"><span class="cl">    <span class="m">1</span> art::TH1FTreeProj f1ppac_Y        f1ppac Y
</span></span><span class="line"><span class="cl">    <span class="m">2</span> art::TH1FTreeProj f1ppac_X1raw    f1ppac X1raw
</span></span><span class="line"><span class="cl">    <span class="m">3</span> art::TH1FTreeProj f1ppac_X2raw    f1ppac X2raw
</span></span><span class="line"><span class="cl">    <span class="m">4</span> art::TH1FTreeProj f1ppac_Y1raw    f1ppac Y1raw
</span></span><span class="line"><span class="cl">    <span class="m">5</span> art::TH1FTreeProj f1ppac_Y2raw    f1ppac Y2raw
</span></span><span class="line"><span class="cl">    <span class="m">6</span> art::TH2FTreeProj f1ppac_x_y      f1ppac X vs Y
</span></span><span class="line"><span class="cl">    <span class="m">7</span> art::TH2FTreeProj f1ppac_x_rf     f1ppac X vs RF
</span></span><span class="line"><span class="cl">    <span class="m">8</span> art::TH2FTreeProj f1ppac_x1_x2    f1ppac x1 vs x2
</span></span><span class="line"><span class="cl">    <span class="m">9</span> art::TH2FTreeProj f1ppac_y1_y2    f1ppac y1 vs y2</span></span></code></pre></div><p>Many histograms are defined, but in practice it&rsquo;s enough to check the first X position.
Sometimes we check other raw data histograms to see if the behavior of F1PPAC is correct or not.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>6<span class="o">]</span> ht <span class="m">0</span></span></span></code></pre></div><p>Usually a gaussian fit is performed to get center the position.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>7<span class="o">]</span> xf</span></span></code></pre></div><p>For the commane &ldquo;xf&rdquo; (xfitg), please check <a href="/artemis_crib/crib_parts/newcommand/index.html">here</a>.</p>
<p>When you think the signals from F1PPAC is okay, but position seems wrong (the X position is different from the setting of F1 slit), pleace modify the parameter files.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/prm/ppac/ch2q.prm" rel="external" target="_blank">prm/ppac/ch2q.prm</a></li>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/prm/ppac/f1ppac.yaml" rel="external" target="_blank">prm/ppac/f1ppac.yaml</a></li>
</ul>
<p>It is actually charge-divition PPAC, but the structure of parameter file is the same with dl-PPAC, so please also check <a href="/artemis_crib/example/online_analysis/f1/../../preparation/ppac_calibration">PPAC preparation</a>.</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 20, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
<div class=" taxonomy-tags term-list cstyle  tags" title="Tags" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <ul>
    <li><a class="term-link" href="/artemis_crib/tags/need_update/index.html">Need_update</a></li>
  </ul>
</div>
            </header>

<h1 id="beam-pid">Beam PID</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>In the F2 focal plane, we check the secondary beam condition.
In other words, identify the beam particles we want and adjust the beamline parameters to get the most amount of the beam particle.
Therefore, we need to identify the beam ion from the data.
To do so, we perform simulation.</p>
<p>This is almost the same with <a href="https://www.cns.s.u-tokyo.ac.jp/crib/cgi-bin/pid/CRIB_PID_calc.html" rel="external" target="_blank">this web application</a>.
This web application uses <code>enewz</code> energy loss calculation, but PID using artemis uses <code>SRIM</code>.</p>
<p>These are the source code for the PID calculation.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/src-crib/simulation/TCRIBPIDProcessor.cc" rel="external" target="_blank">TCRIBPIDProcessor.cc</a></li>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/src-crib/simulation/TCRIBPIDProcessor.h" rel="external" target="_blank">TCRIBPIDProcessor.h</a></li>
</ul>
<h3 id="principles">Principles</h3>
<p>The simple principle of PID (Particle IDentification) is described.</p>
<p>First, the energies of the various beam ions are determined from the value of the magnetic rigidity (
<span class="math align-center">$B\rho$</span>) of the dipole magnets.
The values are then calculated using relativity.</p>

<span class="math align-center">$$ m_0\gamma\frac{v^2}{\rho} = qevB $$
$$ B\rho = \frac{m_0\gamma\beta c}{qe} $$
$$ \frac{B\rho qe}{c} = m_0\frac{\beta}{\sqrt{1-\beta^2}} $$</span><p>From this equation, solving for 
<span class="math align-center">$\beta^2$</span>,</p>

<span class="math align-center">$$ \beta^2 = \frac{1}{1+\left( \frac{m_0 c}{B\rho qe} \right)^2} $$
$$ \frac{1}{\sqrt{1-\beta^2}} = \sqrt{1+\left( \frac{B\rho qe}{m_0 c} \right)^2} $$</span><p>Relativistic energy 
<span class="math align-center">$E$</span> is</p>

<span class="math align-center">$$ E = \frac{m_0 c^2}{\sqrt{1-\beta^2}} $$
$$ E^2 = \left(m_0 c^2\right)^2 + \left( B\rho qec \right)^2 $$</span><p>Therefore, from this equation, 
<span class="math align-center">$E$</span> can be obtained from 
<span class="math align-center">$B\rho$</span> and the kinetic energy can be derived from the following relationship.</p>

<span class="math align-center">$$ E = E_{kin} + m_0 c^2 $$
$$ E_{kin} = m_0 c^2\left( \sqrt{1+\left( \frac{B\rho qec}{m_0 c^2} \right)^2} -1 \right) $$</span><p>The equation for determining velocity from energy using relativity can also be obtained as follows.</p>

<span class="math align-center">$$ E_{kin} + m_0 c^2 = \frac{m_0 c^2}{\sqrt{1-\left(\frac{v}{c}\right)^2}} $$
$$ v = c\sqrt{1-\left( \frac{1}{\frac{E_{kin}}{m_0 c^2} +1} \right)^2} $$</span><p>The energy loss of the detector placed on the beamline is then calculated and the PID diagram is obtained by plotting the possible measured values using these relationships.</p>
<h3 id="usage">Usage</h3>
<p>First, please prepare the SRIMlib dataset.
You need all input ion for &ldquo;mylar&rdquo; and &ldquo;Si&rdquo; target energy loss table.
For the SRIMlib setting, please refer <a href="https://okawak.github.io/artemis_crib/installation/energyloss_calculator/index.html" rel="external" target="_blank">this page</a>.</p>
<p>Next, you need input ions and beamline parameter files.
The format is like this.</p>

<div class="tab-panel" data-tab-group="fbb31ad7b7fbec7491769f909b4ebadf">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmpidexpnameyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('fbb31ad7b7fbec7491769f909b4ebadf','prmpidexpnameyaml')"
    >
      <span class="tab-nav-text">prm/pid/expname.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmpidexpnameyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">input_ions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">7Li3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">charge</span><span class="p">:</span><span class="w"> </span><span class="m">3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mass</span><span class="p">:</span><span class="w"> </span><span class="m">7.01435758</span><span class="w"> </span><span class="c"># amu</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c"># 0 -&gt; red, 1 -&gt; blue, 2 -&gt; black</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">6He2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">charge</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mass</span><span class="p">:</span><span class="w"> </span><span class="m">6.01778863</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">3H1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">charge</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mass</span><span class="p">:</span><span class="w"> </span><span class="m">3.015500905</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">2H1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">charge</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mass</span><span class="p">:</span><span class="w"> </span><span class="m">2.013553496</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">1H1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">charge</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mass</span><span class="p">:</span><span class="w"> </span><span class="m">1.007276452</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">4He2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">charge</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">mass</span><span class="p">:</span><span class="w"> </span><span class="m">4.001506094</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">color</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># BLD parameters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">f1_parameters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">brho</span><span class="p">:</span><span class="w"> </span><span class="m">1.227</span><span class="w"> </span><span class="c"># Tm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rf_period</span><span class="p">:</span><span class="w"> </span><span class="m">57.0</span><span class="w"> </span><span class="c"># ns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">f2_parameters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">PPAC_thickness</span><span class="p">:</span><span class="w"> </span><span class="m">10.0</span><span class="w"> </span><span class="c"># um, mylar</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">SSD_thickness</span><span class="p">:</span><span class="w"> </span><span class="m">1500.0</span><span class="w"> </span><span class="c"># um</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">f3_parameters</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">a_thickness</span><span class="p">:</span><span class="w"> </span><span class="m">15.0</span><span class="w"> </span><span class="c"># um, mylar, PPACa/MWDCa</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">b_thickness</span><span class="p">:</span><span class="w"> </span><span class="m">15.0</span><span class="w"> </span><span class="c"># um, mylar, PPACb/MWDCb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">distance</span><span class="p">:</span><span class="w"> </span><span class="m">290.5</span><span class="w"> </span><span class="c"># mm, between two tracking detectors</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">trigger</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c"># PPACa/MWDCa -&gt; 0, PPACb/MWDCb -&gt; 1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># display parameters</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">f2_display</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rf_offset</span><span class="p">:</span><span class="w"> </span>-<span class="m">6.5</span><span class="w"> </span><span class="c"># ns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rf_range</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.0</span><span class="p">,</span><span class="w"> </span><span class="m">120.0</span><span class="p">]</span><span class="w"> </span><span class="c"># ns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">energy_range</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.0</span><span class="p">,</span><span class="w"> </span><span class="m">100.0</span><span class="p">]</span><span class="w"> </span><span class="c"># MeV</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">f3_display</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rf_offset</span><span class="p">:</span><span class="w"> </span>-<span class="m">12.0</span><span class="w"> </span><span class="c"># ns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tof_offset</span><span class="p">:</span><span class="w"> </span>-<span class="m">2.7</span><span class="w"> </span><span class="c"># ns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">rf_range</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.0</span><span class="p">,</span><span class="w"> </span><span class="m">120.0</span><span class="p">]</span><span class="w"> </span><span class="c"># ns</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">tof_range</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.0</span><span class="p">,</span><span class="w"> </span><span class="m">8.0</span><span class="p">]</span><span class="w"> </span><span class="c"># ns</span></span></span></code></pre></div></div>
    </div>
  </div>
</div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>You can add the beam ions freely, but you need to prepare SRIM Output table.</p>
</div>
</div>
<p>Lastly, let&rsquo;s prepare the steering file.
If you want to do only PID calculation, you can use <code>chkpid.yaml</code>.</p>

<div class="tab-panel" data-tab-group="2d52649c35b5c8d3e9aee4531aeb5934">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringchkpidyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('2d52649c35b5c8d3e9aee4531aeb5934','steeringchkpidyaml')"
    >
      <span class="tab-nav-text">steering/chkpid.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringchkpidyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pid</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TCRIBPIDProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">FileName</span><span class="p">:</span><span class="w"> </span><span class="l">prm/pid/expname.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Batch</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>You can add these sentences for any other steering files.
I think it is useful when you want to overlap the data figure and calculation figure.
If you set <code>Batch: false</code>, the canvases for F2 PID and F3 PID will appear automatically.
<code>Batch: true</code> is quiet mode.</p>
<p>This is an example of the automatically generated figure.</p>
<figure><img src="/artemis_crib/example/online_analysis/pid/auto.png" width="600">
</figure>

<p>The process for the calculation is performed in init process (I mean not event loop), so when you <code>add</code> the steering file, the figure will be created.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; acd
</span></span><span class="line"><span class="cl">&gt; a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/chkpid.yaml
</span></span><span class="line"><span class="cl"><span class="c1"># process is performed now</span>
</span></span><span class="line"><span class="cl"><span class="c1"># if Batch: false, the two PID figure will appear automatically </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> artemis
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> TDirectory pid             pid       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> <span class="nb">cd</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>3<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> pid
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> TMultiGraph                 F2_PID<span class="p">;</span> F2 RF <span class="o">[</span>ns<span class="o">]</span><span class="p">;</span> F2 SSD <span class="o">[</span>MeV<span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="m">1</span> TMultiGraph                 F3_PID<span class="p">;</span> F3 RF <span class="o">[</span>ns<span class="o">]</span><span class="p">;</span> PPACs/MWDCs TOF <span class="o">[</span>ns<span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="m">2</span> TCanvas F2_canvas       F2_canvas 
</span></span><span class="line"><span class="cl">    <span class="m">3</span> TCanvas F3_canvas       F3_canvas 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>4<span class="o">]</span> draw <span class="m">0</span></span></span></code></pre></div><figure><img src="/artemis_crib/example/online_analysis/pid/multigraph.png" width="600">
</figure>


<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>There are two kinds of object, <code>TMultiGraph</code> and <code>TCanvas</code>.
The <code>ht</code> command cannot draw these object, so I also made <code>draw</code> command to be able to draw &ldquo;TMultiGraph&rdquo; objects.</p>
<p>HOWEVER, even this &ldquo;draw&rdquo; command cannot display the &ldquo;TCanvas&rdquo; object yet&hellip;
If you save the object using <code>hstore</code> command or check from THttpServer, you can check the TCanvas objects.</p>
</div>
</div>
<p>This &ldquo;TMultiGraph&rdquo; object is useful when you want to overlay th data.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> ht something <span class="c1"># this is gaussian example</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> dr <span class="m">0</span> p same</span></span></code></pre></div><figure><img src="/artemis_crib/example/online_analysis/pid/overlap.png" width="600">
</figure>


            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="f2">F2</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-20 by Kodai Okawa</span></span>
<p>The basic usage is the same.</p>
<p>We use this steering file to check F2 data.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/steering/chkf2.yaml" rel="external" target="_blank">steering/chkf2.yaml</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ artlogin <span class="o">(</span>username<span class="o">)</span>
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/chkf2.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> sus
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>3<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> artemis
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> art::TTreeProjGroup f2check         f2_check
</span></span><span class="line"><span class="cl">    <span class="m">1</span> art::TAnalysisInfo analysisInfo</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>4<span class="o">]</span> <span class="nb">cd</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>5<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> f2check
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> art::TH1FTreeProj f2PPAC X        f2ppac x
</span></span><span class="line"><span class="cl">    <span class="m">1</span> art::TH1FTreeProj f2PPAC Y        f2ppac y
</span></span><span class="line"><span class="cl">    <span class="m">2</span> art::TH1FTreeProj f2SSD raw       f2ssd raw
</span></span><span class="line"><span class="cl">    <span class="m">3</span> art::TH1FTreeProj f2SSD raw <span class="o">(</span>low<span class="o">)</span> f2ssd raw <span class="o">(</span>low<span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="m">4</span> art::TH1FTreeProj f2SSD cal       f2ssd cal
</span></span><span class="line"><span class="cl">    <span class="m">5</span> art::TH2FTreeProj f2PPAC X vs Y   f2ppac X vs Y
</span></span><span class="line"><span class="cl">    <span class="m">6</span> art::TH2FTreeProj F2PPAC X vs RF0 f2ppac X vs rf0
</span></span><span class="line"><span class="cl">    <span class="m">7</span> art::TH2FTreeProj F2PPAC Y vs RF0 f2ppac Y vs rf0
</span></span><span class="line"><span class="cl">    <span class="m">8</span> art::TH2FTreeProj RF0 vs F2SSD raw rf0 vs f2ssd raw
</span></span><span class="line"><span class="cl">    <span class="m">9</span> art::TH2FTreeProj RF0 vs F2SSD cal rf0 vs f2ssd cal
</span></span><span class="line"><span class="cl">   <span class="m">10</span> art::TH2FTreeProj RF1 vs F2SSD cal rf1 vs f2ssd cal
</span></span><span class="line"><span class="cl">   <span class="m">11</span> art::TH2FTreeProj F2PPAC X vs F2SSD raw f2ppac x vs f2ssd raw
</span></span><span class="line"><span class="cl">   <span class="m">12</span> art::TH2FTreeProj F2PPAC X vs F2SSD cal f2ppac x vs f2ssd cal
</span></span><span class="line"><span class="cl">   <span class="m">13</span> art::TH2FTreeProj F2PPAC Y vs F2SSD cal f2ppac y vs f2ssd cal
</span></span><span class="line"><span class="cl">   <span class="m">14</span> art::TH1FTreeProj RF0             rf0</span></span></code></pre></div><p>As you know, you can check the histograms</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># for 1D histograms</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> ht <span class="o">[</span>id<span class="o">]</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hn <span class="c1"># histogram next</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hb <span class="c1"># histogram before (back?)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># for 2D histograms</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> ht <span class="o">[</span>id<span class="o">]</span> colz <span class="c1"># colz is option</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hn colz
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hb colz</span></span></code></pre></div><p>If you want to save,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> sa
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> pri</span></span></code></pre></div>
            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 20, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="ppac">PPAC</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>updating&hellip;</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="mwdc">MWDC</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>updating&hellip;</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="telescope">Telescope</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>In the CRIB experiment, we often use a &ldquo;telescope&rdquo; consisting of DSSSD (Double-Sided SSD) and SSD (Single-Pad SSD).
The combination of these multiple Si detectors as a dE-E detector is called a <code>telescope</code>.</p>
<p>To analyze the data as telescope data rather than individual detectors, I created a data class called TTelescopeData.
This section describes its data structure and usage.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/src-crib/telescope/TTelescopeData.h" rel="external" target="_blank">src-crib/telescope/TTelescopeData.h</a></li>
</ul>
<p>Please assume that one of the name of TTelescopeData object is &ldquo;tel1&rdquo;</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># after some process</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> br tel1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> art::TTelescopeData
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Data Members
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                 TVector3   fPos                   detected position <span class="o">(</span>X, Y, Z<span class="o">)</span>
</span></span><span class="line"><span class="cl">                      int   fXID                   X strip number
</span></span><span class="line"><span class="cl">                      int   fYID                   Y strip number
</span></span><span class="line"><span class="cl">                      int   fNE                    number of all SSDs
</span></span><span class="line"><span class="cl">                   double   fdE                    energy at first layor
</span></span><span class="line"><span class="cl">                   double   fdEX                   X side energy <span class="o">(=</span>~ fdEY<span class="o">)</span>
</span></span><span class="line"><span class="cl">                   double   fdEY                   Y side energy <span class="o">(=</span>~ fdEX<span class="o">)</span>
</span></span><span class="line"><span class="cl">                   double   fE                     added energy at thick SSDs
</span></span><span class="line"><span class="cl">                   double   fEtotal                all energy deposit in the telescope
</span></span><span class="line"><span class="cl">                   double   fTiming                timing information at the first layor <span class="o">(</span>X side<span class="o">)</span>
</span></span><span class="line"><span class="cl">                   double   fYTiming               <span class="k">for</span> <span class="k">case</span> that X side have trouble <span class="o">(</span>Y side<span class="o">)</span>
</span></span><span class="line"><span class="cl">                   double   fTheta_L               reaction angle in LAB system
</span></span><span class="line"><span class="cl">           vector&lt;double&gt;   fEnergyArray           energy array <span class="k">for</span> each SSD
</span></span><span class="line"><span class="cl">           vector&lt;double&gt;   fTimingArray           timing array <span class="k">for</span> each SSD
</span></span><span class="line"><span class="cl">                ESortType   kID
</span></span><span class="line"><span class="cl">                ESortType   kTiming
</span></span><span class="line"><span class="cl">               ESortOrder   kASC
</span></span><span class="line"><span class="cl">               ESortOrder   kDESC
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># snip for Method as for now</span></span></span></code></pre></div><p>These are the all data members of the &ldquo;TTelescopeData&rdquo;.
The most commonly used variables are &ldquo;fXID&rdquo;, &ldquo;fYID&rdquo;, &ldquo;fdE&rdquo; and &ldquo;fE&rdquo;.
Other variables are accessed by using methods (explain later).
The meaning of these variables are written the upper code block.</p>
<p>We use them like,</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;tel1.fYID:tel1.fXID&gt;&gt;strip(16,-0.5,15.5, 16,-0.5,15.5)&#34;</span>,<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;colz&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;tel1.fdE:tel1.fE&#34;</span>,<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;&#34;</span><span class="o">)</span></span></span></code></pre></div><p>or we can use in histogram definition file of course.</p>
<p>The following are the methods of the TTelescopeData object:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># after some process</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> br tel1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># snip for Data Members</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Methods
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          TTelescopeData<span class="p">&amp;</span>   <span class="nv">operator</span><span class="o">=</span>
</span></span><span class="line"><span class="cl">                 TVector3   GetPosition
</span></span><span class="line"><span class="cl">                 Double_t   X
</span></span><span class="line"><span class="cl">                 Double_t   Y
</span></span><span class="line"><span class="cl">                 Double_t   Z
</span></span><span class="line"><span class="cl">                     void   SetPosition
</span></span><span class="line"><span class="cl">                     void   SetPosition
</span></span><span class="line"><span class="cl">                    Int_t   GetN
</span></span><span class="line"><span class="cl">                     void   SetN
</span></span><span class="line"><span class="cl">                    Int_t   GetXID
</span></span><span class="line"><span class="cl">                     void   SetXID
</span></span><span class="line"><span class="cl">                    Int_t   GetYID
</span></span><span class="line"><span class="cl">                     void   SetYID
</span></span><span class="line"><span class="cl">                 Double_t   GetdE
</span></span><span class="line"><span class="cl">                     void   SetdE
</span></span><span class="line"><span class="cl">                 Double_t   GetdEX
</span></span><span class="line"><span class="cl">                     void   SetdEX
</span></span><span class="line"><span class="cl">                 Double_t   GetdEY
</span></span><span class="line"><span class="cl">                     void   SetdEY
</span></span><span class="line"><span class="cl">                 Double_t   GetE
</span></span><span class="line"><span class="cl">                     void   SetE
</span></span><span class="line"><span class="cl">                 Double_t   GetEtotal
</span></span><span class="line"><span class="cl">                     void   SetEtotal
</span></span><span class="line"><span class="cl">                 Double_t   GetTelTiming
</span></span><span class="line"><span class="cl">                     void   SetTelTiming
</span></span><span class="line"><span class="cl">                 Double_t   GetTelYTiming
</span></span><span class="line"><span class="cl">                     void   SetTelYTiming
</span></span><span class="line"><span class="cl">                 Double_t   GetTheta_L
</span></span><span class="line"><span class="cl">                     void   SetTheta_L
</span></span><span class="line"><span class="cl">                 Double_t   A
</span></span><span class="line"><span class="cl">              DoubleVec_t   GetEnergyArray
</span></span><span class="line"><span class="cl">                 Double_t   GetEnergyArray
</span></span><span class="line"><span class="cl">                     void   PushEnergyArray
</span></span><span class="line"><span class="cl">              DoubleVec_t   GetTimingArray
</span></span><span class="line"><span class="cl">                 Double_t   GetTimingArray
</span></span><span class="line"><span class="cl">                     void   PushTimingArray
</span></span><span class="line"><span class="cl">                 Double_t   E
</span></span><span class="line"><span class="cl">                 Double_t   T
</span></span><span class="line"><span class="cl">                     void   Copy
</span></span><span class="line"><span class="cl">                     void   Clear
</span></span><span class="line"><span class="cl">                   Bool_t   CheckTObjectHashConsistency
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> See also
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     art::TDataObject       base class <span class="k">for</span> data object</span></span></code></pre></div><p>The most commonly used methods are &ldquo;X()&rdquo;, &ldquo;Y()&rdquo;, &ldquo;Z()&rdquo;, &ldquo;E()&rdquo;, &ldquo;T()&rdquo; and &ldquo;A()&rdquo;.
There are also longer name methods, but it is troublesome to write long methods, so I prepared short name methods.
The longer name methods are mainly used in the source processor to make it more readable.</p>
<ul>
<li><code>X()</code>: return fPos.X(), detected X position</li>
<li><code>Y()</code>: return fPos.Y(), detected Y position</li>
<li><code>Z()</code>: return fPos.Z(), detected Z position</li>
<li><code>E()</code>: return fEtotal, total energy deposit in the telescope</li>
<li><code>E(id: int)</code>: return fEnergyArray[id], energy deposit of each Si layer, id=0 means dE, id=1 means second layer</li>
<li><code>T()</code>: return fTiming, detected timing at first layer</li>
<li><code>T(id: int)</code>: return fTimingArray[id], timing at the &ldquo;id&rdquo; th Si detector</li>
<li><code>A()</code>: return fTheta_L, the angle of the event, deg unit</li>
</ul>
<p>We use them like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;tel1.Y():tel1.X()&#34;</span>,<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;colz&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;tel1.E(0):tel1.E()&#34;</span>,<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;colz&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;tel1.E():tel1.A()&#34;</span>,<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;colz&#34;</span><span class="o">)</span></span></span></code></pre></div>
            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="f3">F3</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>In the physics run (production run or physics measurement), we check all the detector data like tracking detector (PPAC, MWDC), TOF (RF) and Telescope data.
In order to analyse them, we prepared steering/chkf3.yaml steering file.
This file includes all the information of F3 analysis.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/steering/chkf3.yaml" rel="external" target="_blank">steering/chkf3.yaml</a></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ artlogin <span class="o">(</span>username<span class="o">)</span>
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/chkf3.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> sus
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>3<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> artemis
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> art::TTreeProjGroup f3check         f3check
</span></span><span class="line"><span class="cl">    <span class="m">1</span> art::TAnalysisInfo analysisInfo
</span></span><span class="line"><span class="cl">    <span class="m">2</span> art::TTreeProjGroup mwdca           mwdca
</span></span><span class="line"><span class="cl">    <span class="m">3</span> art::TTreeProjGroup mwdcb           mwdcb
</span></span><span class="line"><span class="cl">    <span class="m">4</span> art::TTreeProjGroup tel1            tel1
</span></span><span class="line"><span class="cl">    <span class="m">5</span> art::TTreeProjGroup tel2            tel2
</span></span><span class="line"><span class="cl">    <span class="m">6</span> art::TTreeProjGroup tel3            tel3
</span></span><span class="line"><span class="cl">    <span class="m">7</span> art::TTreeProjGroup tel4            tel4
</span></span><span class="line"><span class="cl">    <span class="m">8</span> art::TTreeProjGroup tel5            tel5
</span></span><span class="line"><span class="cl">    <span class="m">9</span> art::TTreeProjGroup tel6            tel6
</span></span><span class="line"><span class="cl">   <span class="m">10</span> art::TTreeProjGroup MUX             MUX
</span></span><span class="line"><span class="cl">   <span class="m">11</span> TDirectory MWDCCalibHists  MWDC calibration
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># this is the situation at 2024/01/22</span></span></span></code></pre></div><p>There are many histogram definition, and you can freely update the histogram files.</p>
<p>Because this file contains most of the knowledge about the steering file, so you can test your own histogram or something based on this file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">cd</span> steering
</span></span><span class="line"><span class="cl">$ cp chkf3.yaml chkYourOwnName.yaml
</span></span><span class="line"><span class="cl">$ vi <span class="o">(</span>emacs<span class="o">)</span> chkYourOwnName.yaml
</span></span><span class="line"><span class="cl"><span class="c1"># change or test something</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ acd
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/chkYourOwnName.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artmeis <span class="o">[</span>2<span class="o">]</span> sus
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># some analysis</span></span></span></code></pre></div>
            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="gate">Gate</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-17 by Kodai Okawa</span></span>
<p>It is very important to select events for online analysis as well.
There are several options to do so, and I will cover all of them.
If you know other useful way, please let me know.</p>
<ul>
<li>Histogram definition</li>
<li>TCutG object</li>
<li>TGateStopProcessor</li>
</ul>
<p>For clearer understanding, we will use this figure, and we call this as default figure:</p>
<figure><img src="/artemis_crib/example/online_analysis/gate/default.png" width="600">
</figure>

<h2 id="histogram-definition">Histogram definition</h2>
<p>We explained in the <a href="/artemis_crib/setting/histograms/index.html">Histograms</a> page, but again we describe about histogram definition focus on the <code>cut</code> part.</p>
<p>The default figure defined like this:</p>

<div class="tab-panel" data-tab-group="fb3efc266632a8640b68be490668ba39">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="histf2f2yaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('fb3efc266632a8640b68be490668ba39','histf2f2yaml')"
    >
      <span class="tab-nav-text">hist/f2/f2.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="histf2f2yaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacx</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fX&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacy</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fY&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">alias</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">group</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2_check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2PPAC X vs Y</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2ppac X vs Y</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacy</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>For example, let&rsquo;s add the gate to select only &ldquo;-10.0 &lt; X &lt; 10.0&rdquo;.
We can use alias node to define that.</p>

<div class="tab-panel" data-tab-group="b8637041665a0f11dae46a8454267f00">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="histf2f2yaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('b8637041665a0f11dae46a8454267f00','histf2f2yaml')"
    >
      <span class="tab-nav-text">hist/f2/f2.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="histf2f2yaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacx</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fX&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacy</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fY&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">alias</span><span class="p">:</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">  </span><span class="nt">centerx</span><span class="p">:</span><span class="w"> </span><span class="l">abs(f2ppac.fX) &lt; 10.0;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">group</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2_check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2PPAC X vs Y{centerx}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2ppac X vs Y{centerx}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacy</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">        </span><span class="nt">cut</span><span class="p">:</span><span class="w"> </span><span class="l">centerx</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>Then the following histogram is created.</p>
<figure><img src="/artemis_crib/example/online_analysis/gate/yaml_gate.png" width="600">
</figure>

<p>Also, multiple conditions can be specified at the same time.</p>

<div class="tab-panel" data-tab-group="bf36de5217e8a4e35714acdb68dcdebb">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="histf2f2yaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('bf36de5217e8a4e35714acdb68dcdebb','histf2f2yaml')"
    >
      <span class="tab-nav-text">hist/f2/f2.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="histf2f2yaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacx</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fX&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacy</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fY&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">alias</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">centerx</span><span class="p">:</span><span class="w"> </span><span class="l">abs(f2ppac.fX) &lt; 10.0;</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">  </span><span class="nt">centery</span><span class="p">:</span><span class="w"> </span><span class="l">abs(f2ppac.fY) &lt; 10.0;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">group</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2_check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2PPAC X vs Y{centerx &amp;&amp; centery}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2ppac X vs Y{centerx &amp;&amp; centery}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacy</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">        </span><span class="nt">cut</span><span class="p">:</span><span class="w"> </span><span class="l">centerx &amp;&amp; centery</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><figure><img src="/artemis_crib/example/online_analysis/gate/yaml_multigate.png" width="600">
</figure>

<h2 id="tcutg-object">TCutG object</h2>
<p>We can also use TCutG object to select the event.
As in <a href="/artemis_crib/crib_parts/newcommand/index.html">new commands</a> page, let&rsquo;s assume we create this TCutG ROOT file by <code>tcutg</code> command.
And the ROOT file and TCutG object name is <code>f2star</code>.</p>
<figure><img src="/artemis_crib/example/online_analysis/gate/tcutg_raw.png" width="600">
</figure>

<p>If you want to use this object to select event, just add this line is fine, as long as you use <a href="/artemis_crib/crib_parts/userconfig/index.html">userlogon.C</a>.</p>

<div class="tab-panel" data-tab-group="43a842571d951cf2cc2ab99b0d557a0a">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="histf2f2yaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('43a842571d951cf2cc2ab99b0d557a0a','histf2f2yaml')"
    >
      <span class="tab-nav-text">hist/f2/f2.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="histf2f2yaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacx</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fX&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;f2ppacy</span><span class="w"> </span><span class="p">[</span><span class="s2">&#34;f2ppac.fY&#34;</span><span class="p">,</span><span class="m">200</span><span class="p">,</span>-<span class="m">50</span><span class="l">.,50.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">alias</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">group</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2_check</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">f2PPAC X vs Y{f2star}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="l">f2ppac X vs Y{f2star}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="cp">*f2ppacy</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">        </span><span class="nt">cut</span><span class="p">:</span><span class="w"> </span><span class="l">f2star</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><figure><img src="/artemis_crib/example/online_analysis/gate/tcutg_star.png" width="600">
</figure>

<p>Of course we can use in &ldquo;tree-&gt;Draw()&rdquo; because this TCutG objects are automatically loaded.
The following sentence generate the same figure.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[]</span> fcd <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[]</span> zo
</span></span><span class="line"><span class="cl">artemis <span class="o">[]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;f2ppac.fY:f2ppac.fX&gt;&gt;(200,-50.,50., 200,-50.,50.)&#34;</span>,<span class="s2">&#34;f2star&#34;</span>,<span class="s2">&#34;colz&#34;</span><span class="o">)</span></span></span></code></pre></div><h2 id="tgatestopprocessor">TGateStopProcessor</h2>
<p>The method used until now was to process just histograms and analyze them for all events in the event loop.
If you know which events you don&rsquo;t want, there are processors that allow you to skip the event loop under certain conditions.
This may speed up the event loop.</p>
<p>For example. when we want to analyze only <code>beam single</code> event (it means the events are not coincident with SSD, and let&rsquo;s suppose that condition is given by <code>single.fID==0</code>), let&rsquo;s prepare the steering file.</p>

<div class="tab-panel" data-tab-group="136312aed4ac9524b388cdd15c4e7ae8">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringgatecoinyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('136312aed4ac9524b388cdd15c4e7ae8','steeringgatecoinyaml')"
    >
      <span class="tab-nav-text">steering/gate/coin.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringgatecoinyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">proc_gateinit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TGateArrayInitializer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">proc_gate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTreeFormulaGateProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Definitions</span><span class="p">:</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">        </span>- <span class="s2">&#34;beam_single; single.fID==0&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Verbose</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">beam_single_gate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TGateStopProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">      </span><span class="nt">GateName</span><span class="p">:</span><span class="w"> </span><span class="l">beam_single</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">StopIf</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Verbose</span><span class="p">:</span><span class="w"> </span><span class="m">1</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>To use TGateStopProcessor, we need to initialize the &ldquo;gate&rdquo; array object, so the first <code>art::TGateArrayInitializer</code> is needed.
In the second processor, <code>art::TTreeFormulaGateProcessor</code>, we define the gate condition.</p>
<p>Then the <code>art::TGateStopProcessor</code> judges the event is skipped or not.
In the case of <code>StopIf: 0</code>, artemis ignore the event that the condition become <code>false</code>.
In other words, <code>StopIf: 0</code> means artemis will analyze the event only when the condition is <code>true</code>.</p>
<p>Then, including this yaml file to the main steering file, you can check only the selected events.</p>

<div class="tab-panel" data-tab-group="5093cead84ca6342525ccf0c87851d3f">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringhogeyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('5093cead84ca6342525ccf0c87851d3f','steeringhogeyaml')"
    >
      <span class="tab-nav-text">steering/hoge.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringhogeyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;input</span><span class="w"> </span><span class="l">ridf/@NAME@@NUM@.ridf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;output</span><span class="w"> </span><span class="l">output/@NAME@/@NUM@/hoge@NAME@@NUM@.root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="cp">&amp;histout</span><span class="w"> </span><span class="l">output/@NAME@/@NUM@/hoge@NAME@@NUM@.hist.root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">timer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTimerProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ridf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TRIDFEventStore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputFiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="cp">*input</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SHMID</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TMappingProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># include some other steering files</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">gate/coin.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">outputtree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TOutputTreeProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">FileName</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="cp">*output</span></span></span></code></pre></div></div>
    </div>
  </div>
</div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>We didn&rsquo;t check if we can use the TCutG object in this process&hellip;</p>
</div>
</div>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 17, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="shifter-task">Shifter task</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-20 by Kodai Okawa</span></span>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 20, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="scaler">Scaler</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-20 by Kodai Okawa</span></span>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 20, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="timestamp">Timestamp</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 15, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="raw-data-checker">Raw data checker</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-01-22 by Kodai Okawa</span></span>
<p>Artemis produces mainly <code>TArtTree</code> and the branches are <code>TClonesArray(art::hoge)</code>.
It means that all objects rely on the artemis library, and we cannot open and check the data by using normal ROOT.</p>
<p>Also, sometimes it is necessary top check the raw data obtained by ADC and TDC as it is.
Of course, the real raw data is binary and therefore difficult to read, so we will check the raw data after the decoders.</p>
<p>Related processors;</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/src-crib/TSegmentOutputProcessor.cc" rel="external" target="_blank">TSegmentOutputProcessor.cc</a></li>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/src-crib/TModuleData.cc" rel="external" target="_blank">TModuleData.cc</a></li>
<li><a href="https://github.com/artemis-dev/artemis/blob/develop/sources/loop/TSegmentCheckProcessor.cc" rel="external" target="_blank">TSegmentCheckProcessor.cc</a> (in original artemis source)</li>
</ul>
<h2 id="how-to-check-the-raw-data">How to check the raw data</h2>
<h3 id="1-prepare-conf-files">1. prepare conf files</h3>
<p>We already prepared <code>conf/map</code> files, but in this case, we need to prepare <code>conf/seg</code> files.
There are two files.
This is an example, so please change it according to the experimental conditions.</p>

<div class="tab-panel" data-tab-group="fe8e2331479ed1d07ded4fc17122caac">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="confsegmodulelistyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('fe8e2331479ed1d07ded4fc17122caac','confsegmodulelistyaml')"
    >
      <span class="tab-nav-text">conf/seg/modulelist.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="confsegmodulelistyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#modulename:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  id: module id (it is module-specific)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  ch: channel number</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#  values:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#    - name1: [Nbin: int, min: double, max: double] it is for 2D histogram (these values vs. ch)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#    - name2: [Nbin: int, min: double, max: double] &lt;= somehow two line needed...?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">MADC32</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ch</span><span class="p">:</span><span class="w"> </span><span class="m">32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">adc</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">4000</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="l">., 4000.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">tdc</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">4000</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="l">., 4000.]</span><span class="w"> </span><span class="c"># no use, but seems it needed...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">V1190A</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">24</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ch</span><span class="p">:</span><span class="w"> </span><span class="m">128</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">values</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">tdcL</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">300</span><span class="p">,</span><span class="w"> </span>-<span class="m">5000</span><span class="l">., 300000.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">tdcT</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">300</span><span class="p">,</span><span class="w"> </span>-<span class="m">5000</span><span class="l">., 300000.]</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>The module id list is <a href="/artemis_crib/example/segid/index.html">here</a>.</p>

<div class="tab-panel" data-tab-group="e82a3bbe4dc4fab7447a6adf06926a02">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="confsegseglistyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('e82a3bbe4dc4fab7447a6adf06926a02','confsegseglistyaml')"
    >
      <span class="tab-nav-text">conf/seg/seglist.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="confsegseglistyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#segment_name:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># segid: [[dev], [fp], [det]] &lt;= same as a map file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># type: V7XX &lt;= defined type in modulelist.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># modules:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   - id: geo1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#   - id: geo2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">V1190</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">segid</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">V1190A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">modules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">MADC</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">segid</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">6</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">MADC32</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">modules</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="m">2</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><h3 id="2-use-steeringchksegyaml">2. use &ldquo;steering/chkseg.yaml&rdquo;</h3>
<p>Based on these two conf file, the <code>steering/chkseg.yaml</code> file produce rawdata histograms and TTree object.
We can use <a href="https://github.com/okawak/artemis_crib/blob/main/steering/chkseg.yaml" rel="external" target="_blank">steering/chkseg.yaml</a> without any change I think.</p>
<p>This is an example from one CRIB experiment.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/chkseg.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> sus
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>3<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> artemis
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> TDirectory SegmentHistogram art::TSegmentCheckProcessor
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>4<span class="o">]</span> <span class="nb">cd</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>5<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> SegmentHistogram
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> TDirectory E7_V1190        E7_V1190
</span></span><span class="line"><span class="cl">    <span class="m">1</span> TDirectory J1_V785         J1_V785
</span></span><span class="line"><span class="cl">    <span class="m">2</span> TDirectory J1_MADC         J1_MADC
</span></span><span class="line"><span class="cl">    <span class="m">3</span> TDirectory J1_V1190        J1_V1190
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>6<span class="o">]</span> <span class="nb">cd</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>7<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> E7_V1190
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> TH2F E7_V1190_0_tdcL E7_V1190_0_tdcL
</span></span><span class="line"><span class="cl">    <span class="m">1</span> TH2F E7_V1190_0_tdcT E7_V1190_0_tdcT
</span></span><span class="line"><span class="cl">    <span class="m">2</span> TH2F E7_V1190_1_tdcL E7_V1190_1_tdcL
</span></span><span class="line"><span class="cl">    <span class="m">3</span> TH2F E7_V1190_1_tdcT E7_V1190_1_tdcT
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># we can check these histograms by ht command</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>8<span class="o">]</span> fcd <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>9<span class="o">]</span> br
</span></span><span class="line"><span class="cl">E7_V1190_0           vector&lt;vector&lt;int&gt; &gt;
</span></span><span class="line"><span class="cl">E7_V1190_1           vector&lt;vector&lt;int&gt; &gt;
</span></span><span class="line"><span class="cl">J1_V785_0            vector&lt;int&gt;
</span></span><span class="line"><span class="cl">J1_V785_1            vector&lt;int&gt;
</span></span><span class="line"><span class="cl">J1_V785_2            vector&lt;int&gt;
</span></span><span class="line"><span class="cl">J1_MADC_3            vector&lt;int&gt;
</span></span><span class="line"><span class="cl">J1_MADC_4            vector&lt;int&gt;
</span></span><span class="line"><span class="cl">J1_MADC_5            vector&lt;int&gt;
</span></span><span class="line"><span class="cl">J1_V1190_0           vector&lt;vector&lt;int&gt; &gt;</span></span></code></pre></div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>If the module ID = 24 or 25, it is multihit TDC, so the branch become 2D vector.
When you want to use std::vector<!-- raw HTML omitted --> method, you can use by &ldquo;@&rdquo; like</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;J1_V785_0@.size()&#34;</span><span class="o">)</span></span></span></code></pre></div></div>
</div>
<p>Of course we can open this output ROOT file from normal ROOT.</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jan 22, 2024
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="offline-analysis">Offline analysis</h1>

<p>This section explain the example of the offline analysis (some useful processors).</p>

<ul class="children children-li children-sort-weight">
	
<li><a href="/artemis_crib/example/offline_analysis/new_processor/index.html">New processors</a></li>
<li><a href="/artemis_crib/example/offline_analysis/merge_files/index.html">Merge files</a></li>
<li><a href="/artemis_crib/example/offline_analysis/python_environment/index.html">Python environment</a></li>
<li><a href="/artemis_crib/example/offline_analysis/pyroot/index.html">pyROOT</a></li>
<li><a href="/artemis_crib/example/offline_analysis/analysis_example/index.html">Analysis example</a></li>
</ul>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 13, 2023
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Offline analysis</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="new-processors">New processors</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by</span></span>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 15, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="merge-files">Merge files</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 15, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="python-environment">Python environment</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 15, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="pyroot">pyROOT</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 15, 2023
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="analysis-example">Analysis example</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-08-14 by Kodai Okawa</span></span>
<p>A brief example of an analysis flow using artemis_crib is given below.
This is just the method recommended by okawak,
so you can proceed with the analysis as you like.</p>
<p>I hope this page will give you some ideas.</p>
<hr>
<ol start="0">
<li>Get calibration paramters</li>
<li>Concentrate on one RUN (one or two hours data) for analysis.</li>
<li>Briefly check other RUNs to see if the trend is the same.</li>
<li>Determine the appropriate gate (like remove noise, not precisely).</li>
<li>Create ROOT files for all RUNs with appropriate Gate.</li>
<li>Merging the ROOT files to one file.</li>
<li>Determine further detailed gates (essensial gate like selecting proton).</li>
<li>Create a ROOT file with only selected events from the original ROOT file.</li>
<li>Repeat steps 6 and 7.</li>
<li>Create a histogram that gives the physical quantity you want.</li>
<li>If necessary, create a simulation and produce a histogram you want.</li>
<li>Manipulate the histograms using macros (.C file) or pyROOT to produce the final result.</li>
</ol>
<hr>
<h5 id="1-concentrate-on-one-run-one-or-two-hours-data-for-analysis"><strong>1. Concentrate on one RUN (one or two hours data) for analysis</strong></h5>
<p>The acquired data contains a lot of noise and other data that is not absolutely necessary for analysis,
and if you use <code>artemis</code> to do an event loop for all events, it will take a long time.
Therefore, a root file should only be created for a specific RUN (data file) to save time.
(It is tempting to look at the data using with a lot of statistics,
but we believe that this is done by online-analysis and concentrate on reducing useless data.)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ artlogin <span class="o">(</span>user<span class="o">)</span>
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[]</span> a steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>run <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[]</span> .q</span></span></code></pre></div><p>As you want to look at a variety of data I think,
it is convenient to create a canvas each time with â€˜tree-&gt;Draw()â€™, instead of defining a histogram.
Not defining a histogram also has the advantage that the event loop is faster.</p>
<p>Once the root file has been created, it can be read directly from that file, eliminating the waiting time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ a output/created_rootfile_path.root
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;hoge&#34;</span><span class="o">)</span></span></span></code></pre></div><p><!-- raw HTML omitted -->It is good idea to make a &ldquo;.C&rdquo; macro file to record and reproduce the analysis process.<!-- raw HTML omitted --></p>
<p>Here are some points I think would be good to check:</p>
<ul>
<li>reproduce the online-analysis</li>
<li>check if the calibration parameter is correct</li>
<li>check multiplicity of the beam tracking detector (PPAC or MWDC)</li>
<li>proper timing of PPACa/b or MWDCa/b (because we may be using multihit TDC, V1190)</li>
<li>check the beam properties difference between &ldquo;beam_single&rdquo; trigger and &ldquo;SSD_coin&rdquo; trigger</li>
<li>RF timing with &ldquo;beam_single&rdquo; and &ldquo;SSD_coin&rdquo; trigger should be different, so need to check the offset value.</li>
<li>check RF timing and contamination of the beam with &ldquo;beam_single&rdquo; trigger</li>
</ul>
<p>If there are problems during the experiment, there may be many other things to check.</p>
<h5 id="2-briefly-check-other-runs-to-see-if-the-trend-is-the-same"><strong>2. Briefly check other RUNs to see if the trend is the same</strong></h5>
<p>It is possible that some parameter is different for each RUN.
There are many possibilities, for example, a trouble may have occurred and the conditions of the detector have changed.
In such cases, it is necessary to take action, for example, to prepare several calibration parameters.</p>
<p>While some of these changes in parameters can be predicted in advance, unforeseen changes can also occur.</p>
<ul>
<li>RF timing sometime change (relatie value)
<ul>
<li>-&gt; need to modify the PID parameters</li>
</ul>
</li>
<li>MUX position parameter sometimes shift
<ul>
<li>-&gt; need to modify position calibration parameter</li>
</ul>
</li>
</ul>
<p>These are the problems I have encountered, but others with different tendencies may exist.</p>
<p>If you can anticipate it, it is good to have a plan for dealing with it at this point and move on to the next step.
However, there is no need to waste time here as it can be noticed after merging the overall measurements in the following step.</p>
<h5 id="3-determine-the-appropriate-gate-like-remove-noise-not-precisely">3. Determine the appropriate gate (like remove noise, not precisely)</h5>
<h5 id="4-create-root-files-for-all-runs-with-appropriate-gate">4. Create ROOT files for all RUNs with appropriate Gate</h5>
<h5 id="5-merging-the-root-files-to-one-file">5. Merging the ROOT files to one file</h5>
<h5 id="6-determine-further-detailed-gates-essensial-gate-like-selecting-proton">6. Determine further detailed gates (essensial gate like selecting proton)</h5>
<h5 id="7-create-a-root-file-with-only-selected-events-from-the-original-root-file">7. Create a ROOT file with only selected events from the original ROOT file</h5>
<h5 id="8-repeat-steps-6-and-7">8. Repeat steps 6 and 7</h5>
<h5 id="9-create-a-histogram-that-gives-the-physical-quantity-you-want">9. Create a histogram that gives the physical quantity you want</h5>
<h5 id="10-if-necessary-create-a-simulation-and-produce-a-histogram-you-want">10. If necessary, create a simulation and produce a histogram you want</h5>
<h5 id="11-manipulate-the-histograms-using-macros-c-file-or-pyroot-to-produce-the-final-result">11. Manipulate the histograms using macros (.C file) or pyROOT to produce the final result</h5>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Aug 14, 2024
            </footer>
          </article>

          </section>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="mc-simulation">MC Simulation</h1>

<p>This section explain the example of the Monte Carlo simulation by using artemis.</p>

<ul class="children children-li children-sort-weight">
	
<li><a href="/artemis_crib/example/simulation/beam_generator/index.html">Beam Generator</a></li>
<li><a href="/artemis_crib/example/simulation/nbodyreaction/index.html">Nbody Reaction</a></li>
<li><a href="/artemis_crib/example/simulation/geometry/index.html">Geometry</a></li>
<li><a href="/artemis_crib/example/simulation/detect_particle/index.html">Detect particles</a></li>
<li><a href="/artemis_crib/example/simulation/solidangle/index.html">Solidangle</a></li>
</ul>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Dec 15, 2023
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of MC Simulation</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="beam-generator">Beam Generator</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-07-16 by Kodai Okawa</span></span>
<p>It is very useful to use Monte Carlo (MC) simulation to obtain various calculated values.
From this section, we will show the simple example how to perform MC simulation using artemis.</p>
<p>First, we will set the generator of the beam that will bombard on the target.
We have two kinds of generator:</p>
<ul>
<li>Random parameter beam (using Random number)</li>
<li>Get beam parameter from ROOT file</li>
</ul>
<p>After you get beam information from a measurement, second option might be useful.</p>
<h2 id="random-beam-generator">Random Beam Generator</h2>
<p>This is an example of a steering file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">random_eventstore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TRandomNumberEventStore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MaxLoop</span><span class="p">:</span><span class="w"> </span><span class="cp">*loopnum</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">beam_generator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TRandomBeamGenerator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputCollection</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTrackCollection</span><span class="p">:</span><span class="w"> </span><span class="cp">*track_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#beam particle information</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MassNum</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">AtomicNum</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ChargeNum</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">IniEnergy</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_E</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c">#beam tracking information</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Xsigma</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w"> </span><span class="c"># mm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Ysigma</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w"> </span><span class="c"># mm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Asigma</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w"> </span><span class="c"># deg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Bsigma</span><span class="p">:</span><span class="w"> </span><span class="m">1.0</span><span class="w"> </span><span class="c"># deg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Esigma</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_Esigma</span></span></span></code></pre></div><p>This produces two branch, &ldquo;beam&rdquo; and &ldquo;track&rdquo;.</p>
<ul>
<li>beam: contain all information about beam ion</li>
<li>track: used for reconstract simulation</li>
</ul>
<p>Actually &ldquo;track&rdquo; information is contained in &ldquo;beam&rdquo; branch.</p>
<p>Here is the detail of the type of &ldquo;beam&rdquo;.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">artemis</span> <span class="p">[]</span> <span class="n">classinfo</span> <span class="n">art</span><span class="o">::</span><span class="n">TParticleInfo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">art</span><span class="o">::</span><span class="n">TParticleInfo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> <span class="n">Data</span> <span class="n">Members</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                      <span class="kt">int</span>   <span class="n">fMassNumber</span>                                
</span></span><span class="line"><span class="cl">                      <span class="kt">int</span>   <span class="n">fAtomicNumber</span>                              
</span></span><span class="line"><span class="cl">                      <span class="kt">int</span>   <span class="n">fCharge</span>                                    
</span></span><span class="line"><span class="cl">                   <span class="kt">double</span>   <span class="n">fEnergy</span>                <span class="n">kinetic</span> <span class="n">energy</span> <span class="n">in</span> <span class="n">LAB</span> <span class="n">system</span>
</span></span><span class="line"><span class="cl">                   <span class="kt">double</span>   <span class="n">fCurrentZ</span>              <span class="n">current</span> <span class="n">Z</span> <span class="n">position</span>  
</span></span><span class="line"><span class="cl">                   <span class="kt">double</span>   <span class="n">fTime</span>                  <span class="n">Duration</span> <span class="n">time</span> <span class="p">(</span><span class="n">ns</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">                   <span class="n">TTrack</span>   <span class="n">fTrack</span>                 <span class="n">tracking</span> <span class="n">information</span> <span class="n">in</span> <span class="n">LAB</span> <span class="n">system</span>
</span></span><span class="line"><span class="cl">           <span class="n">TLorentzVector</span>   <span class="n">fVec</span>                   <span class="n">lorentz</span> <span class="n">vector</span> <span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">pz</span><span class="p">,</span> <span class="n">E</span><span class="p">)</span> <span class="n">of</span> <span class="k">this</span> <span class="n">particle</span>
</span></span><span class="line"><span class="cl">                   <span class="kt">double</span>   <span class="n">fTheta_cm</span>              <span class="n">theta</span> <span class="n">angle</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="n">in</span> <span class="n">CM</span> <span class="n">system</span>
</span></span><span class="line"><span class="cl">                   <span class="kt">double</span>   <span class="n">fPhi_cm</span>                <span class="n">phi</span> <span class="n">angle</span> <span class="p">(</span><span class="n">deg</span><span class="p">)</span> <span class="n">in</span> <span class="n">CM</span> <span class="n">system</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">--</span> <span class="n">snip</span> <span class="o">--</span></span></span></code></pre></div><p><code>fCurrentZ</code> is the current Z position and at the beam generation, this value will be set as 0 after this processor.</p>
<p>For example, the beam angle distribution will be like this.</p>
<figure><img src="/artemis_crib/example/simulation/beam_generator/angle.png" width="400">
</figure>

<h2 id="tree-beam-generator">Tree Beam Generator</h2>
<p>The tracking information obtained from the experiment can also be used to generate the beam.
In the current version, the position and angle of the beam are read from a ROOT file and the energy is given randomly.</p>
<p>This is an example of a steering file.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">periodic_tree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTreePeriodicEventStore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">FileName</span><span class="p">:</span><span class="w"> </span><span class="cp">*input</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TreeName</span><span class="p">:</span><span class="w"> </span><span class="l">tree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MaxEventNum</span><span class="p">:</span><span class="w"> </span><span class="cp">*loopnum</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">proc_copy_processor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TBranchCopyProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputCollection</span><span class="p">:</span><span class="w"> </span><span class="l">f3ppac</span><span class="w"> </span><span class="c"># need to inherit from TTrack</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputCollection</span><span class="p">:</span><span class="w"> </span><span class="cp">*track_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">beam_generator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTreeBeamGenerator</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputCollection</span><span class="p">:</span><span class="w"> </span><span class="cp">*track_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputCollection</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># beam particle information</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">MassNum</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">AtomicNum</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ChargeNum</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_Z</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">IniEnergy</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_E</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">Esigma</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_Esigma</span></span></span></code></pre></div><p>It reads an object named &ldquo;f3ppac&rdquo;, which inherits from TTrack, from a TTree named &ldquo;tree&rdquo; in a file named &ldquo;*input&rdquo;,
and creates an object of the same type as before named <code>TParticleInfo</code>.</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jul 16, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="nbody-reaction">Nbody Reaction</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-07-19 by Kodai Okawa</span></span>
<p>make a reaction considering phase space.</p>
<ul>
<li>steering file example</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">reaction_proc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TNBodyReactionProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputCollection</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputCollection</span><span class="p">:</span><span class="w"> </span><span class="l">products</span><span class="w"> </span><span class="c"># size is DecayParticleNum</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputReactionCollection</span><span class="p">:</span><span class="w"> </span><span class="l">reaction</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># beam information (for initialize TSrim)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">BeamNucleus</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="cp">*beam_Z,</span><span class="w"> </span><span class="cp">*beam_A]</span><span class="w"> </span><span class="c"># (Z, A)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">BeamEnergy</span><span class="p">:</span><span class="w"> </span><span class="cp">*beam_E</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># target information</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetIsGas</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="c"># false-&gt; solid, true-&gt; gas target</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetName</span><span class="p">:</span><span class="w"> </span><span class="l">he</span><span class="w"> </span><span class="c"># from TSrim energy loss</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetMassNum</span><span class="p">:</span><span class="w"> </span><span class="m">4</span><span class="w"> </span><span class="c"># hit ion</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetAtomicNum</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="c"># hit ion</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetThickness</span><span class="p">:</span><span class="w"> </span><span class="m">1000</span><span class="w"> </span><span class="c"># mm (for gas target, allow up to this value)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetPressure</span><span class="p">:</span><span class="w"> </span><span class="m">250</span><span class="w"> </span><span class="c"># Torr (used for gas target)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># reaction particles information</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">DecayParticleNum</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ReactionMassNum</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">29</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="c"># will be [id=0, id=1]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ReactionAtomicNum</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ExciteLevel</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.0</span><span class="p">,</span><span class="w"> </span><span class="m">0.0</span><span class="p">]</span><span class="w"> </span><span class="c"># MeV</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># cross section file, if not, it use constant cross section for energy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># require: &#34;energy cross-section&#34; format, deliminator should be a space &#39; &#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">CrossSectionPath</span><span class="p">:</span><span class="w"> </span><span class="l">path/to/cs/file</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">CrossSectionType</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="c"># 0-&gt; LAB, kinematics is different, 1-&gt; LAB, kinematics is same, 2-&gt; CM</span></span></span></code></pre></div><p><strong>NOTE</strong></p>
<ul>
<li>using TSrim library, so need to set <code>TargetName</code> that registered this library</li>
<li>if cross section file is not found, it use constant dsigma/dE</li>
<li>cross section file format should be</li>
</ul>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl"># comment
</span></span><span class="line"><span class="cl"># energy cross_section
</span></span><span class="line"><span class="cl">0.0 0.0
</span></span><span class="line"><span class="cl">0.1 1.0 # comment
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># 0.2, 2.0 camma is not allowed...</span></span></code></pre></div><ul>
<li>output <code>products</code> is size two array, like products[0] -&gt; id=0 particle</li>
<li>output <code>reaction</code> contain reaction information, like Ecm, Thetacm</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[]</span> classinfo art::TReactionInfo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> art::TReactionInfo
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> Data Members
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                   double   fEnergy                / Ecm of the reaction
</span></span><span class="line"><span class="cl">                   double   fTheta                 / Thetacm of the reaction
</span></span><span class="line"><span class="cl">                   double   fX                     / reaction position at LAB system, x
</span></span><span class="line"><span class="cl">                   double   fY                     / reaction position at LAB system, y
</span></span><span class="line"><span class="cl">                   double   fZ                     / reaction position at LAB system, z
</span></span><span class="line"><span class="cl">                   double   fExEnergy              / excited energy of residual nucleus
</span></span><span class="line"><span class="cl">                ESortType   kID                                        
</span></span><span class="line"><span class="cl">                ESortType   kTiming                                    
</span></span><span class="line"><span class="cl">               ESortOrder   kASC                                       
</span></span><span class="line"><span class="cl">               ESortOrder   kDESC   </span></span></code></pre></div><h2 id="example-of-the-output">Example of the output</h2>
<p>We will show an example of a simulation performed for a <code>gas target case</code> like the steering file above. (of course we can use it also for solid target case!)
Details of the reactions that took place are shown in these figures.
The reaction cross section files are appropriately specified.</p>
<p>This figure is the reaction energy at CM system.</p>
<figure><img src="/artemis_crib/example/simulation/nbodyreaction/reac_energy.png" width="400">
</figure>

<p>This distribution was created from a file of reaction cross section.
The effect of beam energy spread is included, so the edge of the peak is not sharp.</p>
<p>According to this energy distribution, the distribution of the positions of the reactions is as follows.</p>
<figure><img src="/artemis_crib/example/simulation/nbodyreaction/reac_position.png" width="400">
</figure>

<p>The angular distribution at CM system of reactions is assumed to be uniform.
This figure shows the direction of one particle that is produced from this reaction.</p>
<figure><img src="/artemis_crib/example/simulation/nbodyreaction/reac_angle.png" width="400">
</figure>

<p>Also the relationship between the kinematics of the reactions will be like this.</p>
<p><figure><img src="/artemis_crib/example/simulation/nbodyreaction/reac_kinematics1.png" width="400">
</figure>

<figure><img src="/artemis_crib/example/simulation/nbodyreaction/reac_kinematics2.png" width="400">
</figure>
</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jul 19, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="geometry">Geometry</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-07-19 by Kodai Okawa</span></span>
<p>Configure detector geometry to judge if the reaction particle hit the detector or not.</p>

<div class="tab-panel" data-tab-group="17f780a551e62585f44cd684ceb85f24">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmgeoexampleyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('17f780a551e62585f44cd684ceb85f24','prmgeoexampleyaml')"
    >
      <span class="tab-nav-text">prm/geo/example.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmgeoexampleyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">material</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Vaccum</span><span class="w"> </span><span class="c"># id=0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">atomic_mass</span><span class="p">:</span><span class="w"> </span><span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">atomic_num</span><span class="p">:</span><span class="w"> </span><span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">density</span><span class="p">:</span><span class="w"> </span><span class="m">0.0</span><span class="w"> </span><span class="c"># g/cm3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Si</span><span class="w"> </span><span class="c"># id=1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">atomic_mass</span><span class="p">:</span><span class="w"> </span><span class="m">28.084</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">atomic_num</span><span class="p">:</span><span class="w"> </span><span class="m">14.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">density</span><span class="p">:</span><span class="w"> </span><span class="m">2.321</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># Note: beam axis -&gt; z, upper direction -&gt; y</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">conposition</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">detector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tel1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">strip</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">center_rotation</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0</span><span class="l">., 0., 322.0]</span><span class="w"> </span><span class="c"># mm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0</span><span class="l">., 0., 0.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">distance</span><span class="p">:</span><span class="w"> </span><span class="m">244.0</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">angle</span><span class="p">:</span><span class="w"> </span>-<span class="m">4.0</span><span class="w"> </span><span class="c"># deg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">thickness</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.02</span><span class="p">,</span><span class="w"> </span><span class="m">0.301</span><span class="p">,</span><span class="w"> </span><span class="m">1.494</span><span class="p">,</span><span class="w"> </span><span class="m">1.486</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">pedestal</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0</span><span class="l">., 0., 0., 0.]</span><span class="w"> </span><span class="c"># MeV, below this energy, assume 0 MeV</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">Si]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tel2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">strip</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">16</span><span class="p">,</span><span class="w"> </span><span class="m">16</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">center_rotation</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0</span><span class="l">., 0., 322.0]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">offset</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0</span><span class="l">., 0., 0.]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">distance</span><span class="p">:</span><span class="w"> </span><span class="m">154.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">angle</span><span class="p">:</span><span class="w"> </span><span class="m">27.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">thickness</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.02</span><span class="p">,</span><span class="w"> </span><span class="m">0.300</span><span class="p">,</span><span class="w"> </span><span class="m">1.494</span><span class="p">,</span><span class="w"> </span><span class="m">1.485</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">pedestal</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0</span><span class="l">., 0., 0., 0.]</span><span class="w"> </span><span class="c"># MeV, below this energy, assume 0 MeV</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">Si]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volume</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">top</span><span class="p">:</span><span class="w"> </span><span class="c"># detector world</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">TOP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">box</span><span class="w"> </span><span class="c"># now only box is available</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">400.0</span><span class="p">,</span><span class="w"> </span><span class="m">200.0</span><span class="p">,</span><span class="w"> </span><span class="m">1288.0</span><span class="p">]</span><span class="w"> </span><span class="c"># mm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">detector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tel1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">box</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">50.0</span><span class="p">,</span><span class="w"> </span><span class="m">50.0</span><span class="p">,</span><span class="w"> </span><span class="m">1.0</span><span class="p">]</span><span class="w"> </span><span class="c"># mm</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tel2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">box</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">material</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">50.0</span><span class="p">,</span><span class="w"> </span><span class="m">50.0</span><span class="p">,</span><span class="w"> </span><span class="m">1.0</span><span class="p">]</span><span class="w"> </span><span class="c"># mm</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>The geometry information is used only for the judgement, so any material is actually okay.</p>
<p>The <code>material</code> node is used to define <code>TGeoMaterial</code> and <code>TGeoMedium</code> classes.
From <strong>name</strong> to <strong>density</strong> node are used to make a instance of this object.
This values are not used in the current processors.</p>
<p>The next <code>conposition</code> node define the detector configuration.
General telescopes of the CRIB experiment consist of <strong>DSSSD</strong> and <strong>SSD</strong> (single-pad),
and the node below defines the SSD of the telescope.</p>
<ul>
<li>name: Name of the telescope. For example tel1, tel2, and so on.</li>
<li>strip: X x Y strip number. It is defined as an array like [16, 32], this means X:16 strips and Y:32 strips</li>
<li>thickness: Thickness of the each layer. If there are two layer, the size of the array become two. You can add to any size. The unit is <strong>mm</strong>.</li>
<li>material: material of the each layer. The string is used in <code>SRIMlib</code> calculation. This node is defined as a array for each layer, but if it is one, the same material is applied. For example, in example.yaml, [Si] means [Si, Si, Si, Si]. (You need to prepare SRIMlib setting beforehand!)</li>
</ul>
<p>As for the node is <code>center_rotation</code>, <code>offset</code>, <code>distance</code> and <code>angle</code>, please see this figure.</p>
<figure><img src="/artemis_crib/example/simulation/geometry/../geo_example.png">
</figure>

<p>Please note that the center_rotation and offset are defined in (x, y, z) coordinate, and distance and angle are scalar value.
The unit of length is <code>mm</code>, angle is <code>deg</code>.</p>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>The sign of the angle is defined as positive at this figure (right-hand system).
And generally, we set z=0 at target position. (For the gas target, we set 0 at window position.)</p>
</div>
</div>
<p>The last part <code>volume</code> node, the shape of the detector will be defined by using <code>TGeoVolume</code> class.
The TGeoVolume needs <strong>name</strong>, <strong>type</strong>, <strong>material</strong> and <strong>size</strong>.
For the type, I only prepared &ldquo;box&rdquo;. (It means the code use only vol-&gt;MakeBox method.)</p>
<p>The first <code>top</code> node must be set because it defined &ldquo;detector world&rdquo;.
Generally, the material is okay to set vaccum.
And the material is defined in the <code>material</code> node, and the id (the order) can be used.
So the format is like <code>material: 0</code>.
And the size is generally set to the size of the scattering chamber, but for the safety, it is okay to set larger number.
Also the unit is <code>mm</code> and format is (x, y, z).</p>
<p>Next, at the <code>volume/detector</code> node, we can define the detector size.</p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>NOTE: the <code>volume/detector/name</code> should be the same with <code>conposition/detector/name</code> node.</p>
</div>
</div>
<hr>
<p>Then, let&rsquo;s check if the parameter file can be correctly used.</p>

<div class="tab-panel" data-tab-group="58abe3913738c5ed74256292f43a39f2">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringgeo_exampleyaml"
      class="tab-nav-button tab-panel-style cstyle initial active" tabindex="-1"
      onclick="switchTab('58abe3913738c5ed74256292f43a39f2','steeringgeo_exampleyaml')"
    >
      <span class="tab-nav-text">steering/geo_example.yaml</span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringgeo_exampleyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">detector_initialize</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TUserGeoInitializer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">FileName</span><span class="p">:</span><span class="w"> </span><span class="l">prm/geo/example.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">Visible</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>This steering file doesn&rsquo;t use event loop.
Just we want to check the parameter file works well or not.</p>
<p>Then let&rsquo;s see in the artemis!</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ acd
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- snip --
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/geo_example.yaml
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- snip --
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> artemis
</span></span><span class="line"><span class="cl">&gt;   <span class="m">0</span> TGeoVolume TOP             Top volume
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span></span></span></code></pre></div><p>The detector geometry object is successfully generated!
In order to check the object, please use <a href="https://github.com/okawak/artemis_crib/blob/main/src-crib/commands/TCmdDraw.cc" rel="external" target="_blank">draw</a> command for example.
(It is defined only in CRIB artemis, to draw not only histogram object. This is under development.)</p>
<p>Or you can get the object with some methods and <code>obj-&gt;Draw()</code> will work.</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> draw <span class="m">0</span></span></span></code></pre></div><figure><img src="/artemis_crib/example/simulation/geometry/../geo_canvas.png">
</figure>

<p>The red box is the TOP, and the black boxes are detectors.
If the detector is placed where you expect it to be, the parameters have been successfully set!</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jul 19, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="detect-particles">Detect particles</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2024-07-22 by Kodai Okawa</span></span>
<p>Using the defined reactions (TNBodyReactionProcessor) and geometry (TUserGeoInitialiser) so far,
it is possible to determine whether the particles enter the detector after the reaction and to simulate the parameters obtained.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">detector_proc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TDetectParticleProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputCollection</span><span class="p">:</span><span class="w"> </span><span class="l">products</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputTrackCollection</span><span class="p">:</span><span class="w"> </span><span class="l">track</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputCollection</span><span class="p">:</span><span class="w"> </span><span class="l">detects</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># target information (use if gas target)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetIsGas</span><span class="p">:</span><span class="w"> </span><span class="cp">*target_is_gas</span><span class="w"> </span><span class="c"># true -&gt; gas target</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetName</span><span class="p">:</span><span class="w"> </span><span class="cp">*target_name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">TargetPressure</span><span class="p">:</span><span class="w"> </span><span class="cp">*target_pressure</span><span class="w"> </span><span class="c"># Torr (used for gas target)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">EnergyResolution</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">0.0</span><span class="p">]</span><span class="w"> </span><span class="c"># x 100 = %, det id = 0, 1, ..</span></span></span></code></pre></div><ul>
<li><code>products</code> is an array object of produced ions [id=0 ion, id=1 ion&hellip;]</li>
<li><code>detects</code> is an array object of detected ions [id=0 ion, id=1 ion&hellip;]</li>
</ul>
<h2 id="example-of-the-output">Example of the output</h2>
<p>We will show an example of a simulation performed for a <strong>gas target case</strong>, and resolution = 0.0.</p>
<p>First, this is a figure of the detected position of light particle.
We defined five telescopes in this example, and we can clearly see the position of the detectors.
If we focus on heavy particle, we cannot see the position distribution because all ions are stopped in the gas target.</p>
<figure><img src="/artemis_crib/example/simulation/detect_particle/reac_pos.png" width="400">
</figure>

<p>As an example, we will show you figures of a telescope with the largest angle.
Here is dE-E plots.</p>
<figure><img src="/artemis_crib/example/simulation/detect_particle/dee.png" width="400">
</figure>

<p>The relationship between energy and timing is like this.</p>
<figure><img src="/artemis_crib/example/simulation/detect_particle/et.png" width="400">
</figure>

<p>Also, here is the angular distribution of the LAB system.</p>
<figure><img src="/artemis_crib/example/simulation/detect_particle/angle.png" width="400">
</figure>

<h2 id="summary">Summary</h2>
<p>The processor created by <a href="https://github.com/okawak" rel="external" target="_blank">okawak</a> allows simple simulations to be performed without creating new sources,
if the following conditions are met.</p>
<ul>
<li>use latest version of artemis_crib</li>
<li>properly install and link <a href="https://www.cns.s.u-tokyo.ac.jp/gitlab/hayakawa/tsrim" rel="external" target="_blank">TSrim</a> library</li>
<li>the target is registered the TSrim library</li>
<li>relatively low energy (some parts use classical kinematics)</li>
<li>the shape of the detectors is square (may update?)</li>
</ul>
<p>There are only two files that need to be prepared for the simulation.</p>
<ul>
<li><code>prm/geo/hoge.yaml</code> -&gt; define detector configuration (example <a href="https://github.com/okawak/artemis_crib/blob/main/prm/geo/si26a.yaml" rel="external" target="_blank">prm/geo/si26a.yaml</a>)
<ul>
<li>It is useful to make symbolic link to <code>current</code></li>
</ul>
</li>
<li><code>steering/huga.yaml</code> -&gt; define simulation parameters (example <a href="https://github.com/okawak/artemis_crib/blob/main/steering/simNBodyReaction.yaml" rel="external" target="_blank">steering/simNBodyReaction.yaml</a>)</li>
</ul>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:kodak2022@outlook.jp">okawak</a>
              <i class='fa-fw fas fa-calendar'></i> Jul 22, 2024
            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>

<h1 id="solidangle">Solidangle</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-09-29 by KodaiOkawa</span></span>
<ul>
<li>Beam_generator</li>
<li>Nbodyreaction</li>
<li>Geometry</li>
<li>Detect_particle</li>
</ul>
<p>As an application of the above four sections, I would like to explain how to calculate solid angles using Monte Carlo methods!</p>

            <footer class="footline">
              <i class='fa-fw fas fa-user'></i> <a href="mailto:okawa@cns.s.u-tokyo.ac.jp">KodaiOkawa</a>
              <i class='fa-fw fas fa-calendar'></i> Sep 29, 2023
            </footer>
          </article>

          </section>
          </section>
        </div>
      </main>
    </div>
    <script src="/artemis_crib/js/clipboard.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/perfect-scrollbar.min.js?1723613657" defer></script>
    <script>
      function useMathJax( config ){
        window.MathJax = Object.assign( window.MathJax || {}, {
          tex: {
            inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
            displayMath: [['\\[', '\\]'], ['$$', '$$']], 
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/artemis_crib/js/d3/d3-color.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-dispatch.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-drag.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-ease.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-interpolate.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-selection.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-timer.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-transition.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/d3/d3-zoom.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/js-yaml.min.js?1723613657" defer></script>
    <script src="/artemis_crib/js/mermaid.min.js?1723613657" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/artemis_crib/js/theme.js?1723613657" defer></script>
  </body>
</html>
