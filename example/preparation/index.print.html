<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.121.2">
    <meta name="generator" content="Relearn 5.22.0">
    <meta name="description" content="Documentation for CRIB artemis">
    <meta name="author" content="map[name:Kodai Okawa]">
    <title>Preparation :: CRIB artemis</title>
    <link href="https://okawak.github.io/artemis_crib/example/preparation/index.html" rel="canonical" type="text/html" title="Preparation :: CRIB artemis">
    <link href="/artemis_crib/example/preparation/index.xml" rel="alternate" type="application/rss+xml" title="Preparation :: CRIB artemis"><link rel="icon" href="/artemis_crib/images/crib_overlay.png" type="image/png">

    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="/artemis_crib/css/fontawesome-all.min.css?1705744582" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/artemis_crib/css/fontawesome-all.min.css?1705744582" rel="stylesheet"></noscript>
    <link href="/artemis_crib/css/nucleus.css?1705744582" rel="stylesheet">
    <link href="/artemis_crib/css/auto-complete.css?1705744582" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/artemis_crib/css/auto-complete.css?1705744582" rel="stylesheet"></noscript>
    <link href="/artemis_crib/css/perfect-scrollbar.min.css?1705744582" rel="stylesheet">
    <link href="/artemis_crib/css/fonts.css?1705744582" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/artemis_crib/css/fonts.css?1705744582" rel="stylesheet"></noscript>
    <link href="/artemis_crib/css/theme.css?1705744582" rel="stylesheet">
    <link href="/artemis_crib/css/theme-CRIB-theme.css?1705744582" rel="stylesheet" id="R-variant-style">
    <link href="/artemis_crib/css/variant.css?1705744582" rel="stylesheet">
    <link href="/artemis_crib/css/print.css?1705744582" rel="stylesheet" media="print">
    <link href="/artemis_crib/css/format-print.css?1705744582" rel="stylesheet">
    <link href="/artemis_crib/css/ie.css?1705744582" rel="stylesheet">
    <script src="/artemis_crib/js/url.js?1705744582"></script>
    <script src="/artemis_crib/js/variant.js?1705744582"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="/artemis_crib/index.search.js";
      var root_url="/";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copy to clipboard';
      window.T_Copied_to_clipboard = 'Copied to clipboard!';
      window.T_Copy_link_to_clipboard = 'Copy link to clipboard';
      window.T_Link_copied_to_clipboard = 'Copied link to clipboard!';
      window.T_Reset_view = 'Reset view';
      window.T_No_results_found = 'No results found for \u0022{0}\u0022';
      window.T_N_results_found = '{1} results found for \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/okawak.github.io\/artemis_crib/';
      window.variants && variants.init( [ 'CRIB-theme', 'relearn-auto', 'relearn-dark', 'zen-dark', 'learn' ] );
    </script>

  
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-MZF67K577Y"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
  
    gtag('config', 'G-MZF67K577Y');
  </script>
  


  </head>
  <body class="mobile-support print" data-url="/artemis_crib/example/preparation/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide">
              <button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)">
                <i class="fa-fw fas fa-bars"></i>
              </button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="/artemis_crib/example/index.html"><span itemprop="name">Example</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Preparation</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable default" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="default">
            <header class="headline">
            </header>
<h1 id="preparation">Preparation</h1>

<p>This section explain the example of preparation by using some useful macro.</p>

<ul class="children children-li children-sort-weight">
	
<li><a href="/artemis_crib/example/preparation/basic/index.html">Basic</a></li>
<li><a href="/artemis_crib/example/preparation/tref/index.html">Tref for V1190</a></li>
<li><a href="/artemis_crib/example/preparation/ppac_calibration/index.html">PPAC calibration</a></li>
<li><a href="/artemis_crib/example/preparation/mwdc_calibration/index.html">MWDC calibration</a></li>
<li><a href="/artemis_crib/example/preparation/alpha_calibration/index.html">Alpha calibration</a></li>
<li><a href="/artemis_crib/example/preparation/mux_calibration/index.html">MUX calibration</a></li>
<li><a href="/artemis_crib/example/preparation/set_parameter/index.html">Set parameters</a></li>
<li><a href="/artemis_crib/example/preparation/git/index.html">Git</a></li>
</ul>

            <footer class="footline">

            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Preparation</h1>
          <article class="default">
            <header class="headline">
            </header>
<h1 id="basic">Basic</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-13 by Kodai Okawa</span></span>
<p>I would now like to introduce the actual analysis using the CRIB analysis server.
There are two ways to enter the analysis server, directly or remotely via ssh.
If you come to CRIB and operate the server directly, I think it is quicker to analyse using the server
while asking the CRIB members directly as I think they are nearby.</p>
<h3 id="1-ssh-configuration">1. SSH configuration</h3>
<p>To enter the CRIB server, you need to enter the CNS network.
To do this, you need to create an account on the CNS login server.
Please contact Okawa (<a href="mailto:okawa@cns.s.u-tokyo.ac.jp">okawa@cns.s.u-tokyo.ac.jp</a>) or the person responsible for CRIB <a href="https://www.cns.s.u-tokyo.ac.jp/crib/crib-new/home-en/index.html" target="_blank">(see here)</a> and tell us that you want a login server account.</p>
<p>The CNS login server uses public key cryptography, so you need to send a shared key when you apply.
This section describes how to create the key, especially on MacOS.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> <span class="c1"># move to /Users/yourname/ (home directory)</span>
</span></span><span class="line"><span class="cl">mkdir .ssh <span class="c1"># if there is no .ssh directory</span>
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> .ssh
</span></span><span class="line"><span class="cl">ssh-keygen</span></span></code></pre></div><p>You will be asked a number of interactive questions after this command, all of which are fine by default (Enter).
Then you will see the pair of public-key and private-key.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ls 
</span></span><span class="line"><span class="cl">id_rsa  id_rsa.pub</span></span></code></pre></div><p><code>id_rsa</code> is the private-key, and <code>id_rsa.pub</code> is the public-key.
The private key is important for security reasons and should be kept on your own computer.
Then, please send this public-key to the CNS member.
in MacOS, <code>open .</code> command will open a finder for that directory, so it is easy to attach it to an email from here.
In the email,</p>
<ul>
<li>your fullname (affiliation)</li>
<li>username</li>
<li>attached public-key</li>
</ul>
<p>are needed.</p>
<p>Next, let&rsquo;s set up multi-stage ssh.
As the login server is just a jump server, it is useful to be able to ssh to the CRIB analysis server at once!
So create the following config file. The file placed in this directory is automatically read when you ssh.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ~/.ssh
</span></span><span class="line"><span class="cl">vi config</span></span></code></pre></div>
  
<div class="tab-panel" data-tab-group="d69c87ad14002c9c16703c70206c05f5">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="sshconfig"
      class="tab-nav-button tab-panel-style cstyle initial active"
      onclick="switchTab('d69c87ad14002c9c16703c70206c05f5','sshconfig')"
    >
      <span>
        <span class="tab-nav-hidden">~/.ssh/config</span>
        <span class="tab-nav-text">~/.ssh/config</span>
      </span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="sshconfig"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-aconf" data-lang="aconf"><span class="line"><span class="ln"> 1</span><span class="cl"><span class="nb">Host</span> login
</span></span><span class="line hl"><span class="ln"> 2</span><span class="cl">    <span class="nb">HostName</span> CNS_loginserver_hostname
</span></span><span class="line hl"><span class="ln"> 3</span><span class="cl">    <span class="nb">User</span> username
</span></span><span class="line"><span class="ln"> 4</span><span class="cl">    <span class="nb">IdentityFile</span> ~/.ssh/id_rsa
</span></span><span class="line"><span class="ln"> 5</span><span class="cl">    <span class="nb">ForWardX11Timeout</span> <span class="m">24</span>h
</span></span><span class="line"><span class="ln"> 6</span><span class="cl">    <span class="nb">ControlPersist</span> <span class="m">30</span>m
</span></span><span class="line"><span class="ln"> 7</span><span class="cl">    <span class="nb">ForwardAgent</span> yes
</span></span><span class="line"><span class="ln"> 8</span><span class="cl">    <span class="nb">ControlMaster</span> auto
</span></span><span class="line"><span class="ln"> 9</span><span class="cl">    <span class="nb">ControlPath</span> ~/.ssh/mux-%r@%h:%p
</span></span><span class="line"><span class="ln">10</span><span class="cl">
</span></span><span class="line"><span class="ln">11</span><span class="cl"><span class="c"># any name is okay</span>
</span></span><span class="line"><span class="ln">12</span><span class="cl"><span class="nb">Host</span> cribana
</span></span><span class="line hl"><span class="ln">13</span><span class="cl">    <span class="nb">HostName</span> analysisPC_hostname
</span></span><span class="line"><span class="ln">14</span><span class="cl">    <span class="nb">User</span> crib
</span></span><span class="line"><span class="ln">15</span><span class="cl">    <span class="nb">IdentityFile</span> ~/.ssh/id_rsa
</span></span><span class="line"><span class="ln">16</span><span class="cl">    <span class="nb">ProxyCommand</span> ssh login nc %h %p
</span></span><span class="line"><span class="ln">17</span><span class="cl">    <span class="nb">ForwardAgent</span> yes
</span></span><span class="line"><span class="ln">18</span><span class="cl">    <span class="nb">ControlMaster</span> auto
</span></span><span class="line"><span class="ln">19</span><span class="cl">    <span class="nb">ControlPath</span> ~/.ssh/mux-%r@%h:%p
</span></span><span class="line"><span class="ln">20</span><span class="cl">    <span class="nb">ControlPersist</span> <span class="m">30</span>m</span></span></code></pre></div></div>
    </div>
  </div>
</div><p>You will be informed of the second and third lines above that we highlighted, so please change this parts.
And ask the IP address of the CRIB analysis PC to the CRIB member, and change the 13 line.</p>
<p>Then you can enter the CRIB analysis PC just by</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ssh cribana</span></span></code></pre></div><p>CRIB member will tell you the passward!</p>
<p>For the VNC server (local forwarding), please see <a href="https://okawak.github.io/artemis_crib/setting/vncserver/index.html" target="_blank">this section</a>.</p>
<h3 id="2-your-artemis-configuration">2. your artemis configuration</h3>
<p>When you enter the CRIB computer, please check this is <code>zsh</code> shell.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; <span class="nb">echo</span> <span class="nv">$SHELL</span>
</span></span><span class="line"><span class="cl">/usr/local/bin/zsh</span></span></code></pre></div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>Currently, zsh installed locally is used. It is planned to update the OS in the future, after which it will differ from this path in the future.</p>
</div>
</div>
<p>If it is not <code>zsh</code> (like bash), please command</p>
<div class="wrap-code highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; zsh</span></span></code></pre></div><p>Then you can start to configure by</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; artlogin yourname
</span></span><span class="line"><span class="cl"><span class="c1"># input your information...</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; mkdir build
</span></span><span class="line"><span class="cl">&gt; <span class="nb">cd</span> build
</span></span><span class="line"><span class="cl">&gt; cmake ..
</span></span><span class="line"><span class="cl">&gt; make -j4
</span></span><span class="line"><span class="cl">&gt; make install
</span></span><span class="line"><span class="cl">&gt; acd</span></span></code></pre></div><p>For the detail, please check <a href="https://okawak.github.io/artemis_crib/setting/new_user/index.html" target="_blank">here</a>.</p>
<h3 id="3-basic-usage">3. basic usage</h3>
<ul>
<li>start artemis</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; acd <span class="c1"># move to your artemis work directory</span>
</span></span><span class="line"><span class="cl">&gt; a <span class="c1"># start artemis!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; a macro/macro.C <span class="c1"># run macro script</span></span></span></code></pre></div><ul>
<li>important command in the artemis console</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># read steering file</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># start event loop</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> start <span class="c1"># defined in CRIB artemis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># stop event loop</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> sus
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> stop <span class="c1"># defined in CRIB artemis</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># help</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> <span class="nb">help</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># quit from artemis</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> .q</span></span></code></pre></div><ul>
<li>commands for checking histograms</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># check and move the directory</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> ls
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> <span class="nb">cd</span> <span class="m">0</span> <span class="c1"># cd ID</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move to home directory in artemis</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> <span class="nb">cd</span> <span class="c1"># cd .. will work?</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># draw the histograms</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> ht <span class="m">0</span> colz <span class="c1"># ht ID option</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hn colz <span class="c1"># draw the next histogram object</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> hb colz <span class="c1"># draw the previous histogram object</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># divide the canvas</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> zone <span class="m">2</span> <span class="m">2</span> <span class="c1"># 2 x 2 canvas</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># save and print the canvas</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> sa
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> pri</span></span></code></pre></div><ul>
<li>analize using TTree</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># check the files</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> fls
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># move to the created ROOT file</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> fcd <span class="m">0</span> <span class="c1"># fcd fileID</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check the all branches</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> br
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># check the data members or methods</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> br branchname <span class="c1"># ex. artemis [1] br ppaca</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># the name of TTree object is &#34;tree&#34; (actually TArtTree object)</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>*<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;ppaca.fY:ppaca.fX&gt;&gt;ppaca(100,-20.,20., 100,-20.,20.)&#34;</span>,<span class="s2">&#34;&#34;</span>,<span class="s2">&#34;colz&#34;</span><span class="o">)</span></span></span></code></pre></div><p>See <a href="https://okawak.github.io/artemis_crib/setting/artemis_commands/index.html" target="_blank">here</a> for an example using random numbers.</p>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="tref-for-v1190">Tref for V1190</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>
<p>CRIB uses a multi-hit TDC called V1190 to take timing data (<a href="https://drive.google.com/file/d/1YRwkuFTjKFb5OvC1EfxYZtOGGdf-zKkS/view?usp=sharing" target="_blank">manual</a>).
When a trigger comes into this module, it opens a window with a set time width and records the timing of the data.</p>
<p>However, even if the signal is sent at exactly the same time to the trigger, due to the uncertainty in opening that window, the resulting channel will vary.
Since absolute channel values will vary, but relative channel values for a given (especially trigger) timing will remain the same, it is necessary to subtract all data by some reference channel to achieve good timing resolution.</p>
<p>The signal that serves as the reference for that time is what we call <code>Tref</code>!
(Time reference)
Since it is essential that all events contain that data, we put the trigger signal in one of the channels and make it a Tref.</p>
<p>The &ldquo;tref&rdquo; settings are made in the following file:</p>

  
<div class="tab-panel" data-tab-group="73c8cce1d18b46a636334a0102d5a6f4">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringtrefyaml"
      class="tab-nav-button tab-panel-style cstyle initial active"
      onclick="switchTab('73c8cce1d18b46a636334a0102d5a6f4','steeringtrefyaml')"
    >
      <span>
        <span class="tab-nav-hidden">steering/tref.yaml</span>
        <span class="tab-nav-text">steering/tref.yaml</span>
      </span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringtrefyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># J1 V1190A</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">proc_tref_v1190A_j1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTimeReferenceProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># [[device] [focus] [detector] [geo] [ch]]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">RefConfig</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">  </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">15</span><span class="p">]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">SegConfig</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="m">12</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w">  </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">]</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>Parameters <code>RefConfig</code> and <code>SegConfig</code> are set using the same ID as in the <a href="https://okawak.github.io/artemis_crib/setting/map_config/index.html" target="_blank">map file</a>.</p>
<p>The &ldquo;RefConfig&rdquo; represents the &ldquo;Tref&rdquo; signal and the &ldquo;SegConfig&rdquo; represents the V1190 module.
Therefore, the role of the processor is to subtract the &ldquo;Segconfig&rdquo; V1190 all timing signal from the &ldquo;RefConfig&rdquo; tref signal.</p>
<p>To apply this processor, add the following line to the steering file.
For example,</p>

  
<div class="tab-panel" data-tab-group="5591def8924c59aec49df872c19fd53f">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="steeringchkf3yaml"
      class="tab-nav-button tab-panel-style cstyle initial active"
      onclick="switchTab('5591def8924c59aec49df872c19fd53f','steeringchkf3yaml')"
    >
      <span>
        <span class="tab-nav-hidden">steering/chkf3.yaml</span>
        <span class="tab-nav-text">steering/chkf3.yaml</span>
      </span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="steeringchkf3yaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Anchor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="cp">&amp;input</span><span class="w"> </span><span class="l">ridf/@NAME@@NUM@.ridf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="cp">&amp;output</span><span class="w"> </span><span class="l">output/chkf3@NAME@@NUM@.root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span>- <span class="cp">&amp;histout</span><span class="w"> </span><span class="l">output/chkf3@NAME@@NUM@.hist.root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Processor</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">timer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TTimerProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ridf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TRIDFEventStore</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">InputFiles</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="cp">*input</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">mapper</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TMappingProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">OutputTransparency</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">tref.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">rf/rf.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">coin/coin.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">ppac/dlppac.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="l">ssd/f3ssd.yaml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">outputtree</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TOutputTreeProcessor</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">parameter</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">FileName</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="cp">*output</span></span></span></code></pre></div></div>
    </div>
  </div>
</div>
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>The tref.yaml should be written before the main processor. In this example, it is written right after TMappingProcessor, and we recommend writing it in this position.</p>
</div>
</div>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="ppac-calibration">PPAC calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-18 by Kodai Okawa</span></span>
<p>CRIB use two kinds of PPAC (Parallel-Plate Avalanche Counter), charge division method or delay-readout method.
The PPAC placed at the F1 focal plane is charge-devision type, and the parameters to be converted to position are fixed and do not need to be calibrated.
Therefore we explain the calibration method for delay-line PPAC (dl-PPAC).</p>
<h2 id="principles">Principles</h2>
<p>Here we briefly describe the principle of converting from the obtained signal to position, but for more details, see here<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p>We will discuss the x-direction because x and y is exactly same.
First, define the parameters as follows</p>
<ol>
<li>
<span class="math align-center">$k_x$</span> : convert from signal time difference to position [mm/ns]</li>
<li>
<span class="math align-center">$T_{X1},~T_{X2}$</span> : time at both ends of delay-line, measured at TDC [ns]</li>
<li>
<span class="math align-center">$T_{Xin-offset}$</span> : timing offset come from inside the chamber [ns]</li>
<li>
<span class="math align-center">$T_{Xout-offset}$</span> : timing offset come from outside the chamber [ns] (like from cabling)</li>
<li>
<span class="math align-center">$X_{offset}$</span> : geometry offset [mm]</li>
</ol>
<p>The artemis codes calculate the X position like this formula (see <a href="https://github.com/artemis-dev/artemis/blob/develop/artemis-share/src/ppac/TPPACProcessor.cc" target="_blank">TPPACProcessor.cc</a>).</p>

<span class="math align-center">$$ X~\mathrm{[mm]} = k_x\left( \frac{T_{X1} - T_{X2} + T_{Xin-offset} - T_{Xout-offset}}{2} \right) - X_{offset}$$</span>
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>Check the sign carefully! We often mistook the direction!!</p>
</div>
</div>
<h2 id="fixed-parameters">Fixed parameters</h2>
<p>The 
<span class="math align-center">$T_{X1},~T_{X2}$</span> are measured value by TDC, and 
<span class="math align-center">$k_x$</span> and 
<span class="math align-center">$T_{Xin-offset}$</span> are specific value to PPAC, so we need to care only 
<span class="math align-center">$T_{Xout-offset}$</span> and 
<span class="math align-center">$X_{offset}$</span>.

<span class="math align-center">$X_{offset}$</span> value depends on where we put the PPAC, so what we have to do is determine the line calibration parameter (
<span class="math align-center">$T_{Xout-offset}$</span>).</p>
<p>The following is a list of dl-PPAC parameters used in CRIB experiment.</p>
<table>
<thead>
<tr>
<th>PPAC ID</th>
<th>
<span class="math align-center">$k_x$</span> [mm/ns]</th>
<th>
<span class="math align-center">$k_y$</span> [mm/ns]</th>
<th>
<span class="math align-center">$T_{Xin-offset}$</span></th>
<th>
<span class="math align-center">$T_{Yin-offset}$</span></th>
</tr>
</thead>
<tbody>
<tr>
<td>#2</td>
<td>1.256</td>
<td>1.256</td>
<td>0.29 mm</td>
<td>0.18 mm</td>
</tr>
<tr>
<td>#3</td>
<td>1.264</td>
<td>1.253</td>
<td>0.22 mm</td>
<td>0.30 mm</td>
</tr>
<tr>
<td>#7</td>
<td>1.240</td>
<td>1.242</td>
<td>0.92 ns</td>
<td>1.58 ns</td>
</tr>
<tr>
<td>#8</td>
<td>1.241</td>
<td>1.233</td>
<td>0.17 ns</td>
<td>0.11 ns</td>
</tr>
<tr>
<td>#9</td>
<td>1.257</td>
<td>1.257</td>
<td>0.05 mm</td>
<td>0.04 mm</td>
</tr>
<tr>
<td>#10</td>
<td>1.257</td>
<td>1.257</td>
<td>0.05 mm</td>
<td>0.04 mm</td>
</tr>
</tbody>
</table>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>Different units are used for the offset. However, since the effect of this offset is eventually absorbed to the other offset value, it is no problem to use the values if we calibrate it correctly.</p>
</div>
</div>
<h2 id="parameter-setting">Parameter setting</h2>
<p>PPAC parameters are defined in the following files</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/prm/ppac/dlppac.yaml" target="_blank">prm/ppac/dlppac.yaml</a></li>
</ul>
<p>For example, it is like this:</p>

  
<div class="tab-panel" data-tab-group="99c9c938f7c729f1ce8d7cc5ed2f59fc">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmppacdlppacyaml"
      class="tab-nav-button tab-panel-style cstyle initial active"
      onclick="switchTab('99c9c938f7c729f1ce8d7cc5ed2f59fc','prmppacdlppacyaml')"
    >
      <span>
        <span class="tab-nav-hidden">prm/ppac/dlppac.yaml</span>
        <span class="tab-nav-text">prm/ppac/dlppac.yaml</span>
      </span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmppacdlppacyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TPPACParameter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c"># #7 PPAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">f3bppac</span><span class="p">:</span><span class="w"> </span><span class="c"># this is the name of PPAC, should be the same name with the one in steering file!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ns2mm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.240</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.242</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">delayoffset</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">0.92</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.58</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">linecalib</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">1.31</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="m">1.00</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 0: no exchange, 1: X -&gt; Y, Y -&gt; X</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">exchange</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># 0: no reflect, 1: X -&gt; -X</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reflectx</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geometry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">0.5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">322.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TXSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">2000.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TYSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="m">2000.0</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><ul>
<li>
<p>ns2mm</p>
<p>This is 
<span class="math align-center">$k_x$</span> and 
<span class="math align-center">$k_y$</span> parameters -&gt; input the fixed value</p>
</li>
<li>
<p>delayoffset</p>
<p>This is 
<span class="math align-center">$T_{Xin-offset}$</span> and 
<span class="math align-center">$T_{Yin-offset}$</span> parameters -&gt; input the fixed value</p>
</li>
<li>
<p>linecalib</p>
<p>This is explained next.</p>
</li>
<li>
<p>exchange, reflectx</p>
<p>This parameter should be changed depending on the direction in which the PPAC is placed. The meanings of the parameters are given above as comments.

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>CRIB takes a coordinate system such that when viewed from downstream of the beam, the x-axis is rightward and the y-axis is upward. In other words, it takes a right-handed coordinate system with the beam as the Z-axis. While looking at the actual data, change these parameters so that the coordinate system becomes this coordinate system.</p>
</div>
</div></p>
</li>
<li>
<p>geometry</p>
<p>In the Line calibration, please set this value to (0,0).
After Line calibration, if we put the PPAC with some geometry offset, we should change this parameters.
Please be careful that the parameter will add minus this value for X and Y.
Z offset will be used for <a href="https://github.com/artemis-dev/artemis/blob/develop/artemis-share/src/ppac/TPPACProcessor.cc" target="_blank">TPPACTrackingProcessor</a>.</p>
</li>
<li>
<p>TXSumLimit, TYSumLimit</p>
<p>Used to determine if it is a good event or not. Currently not used.</p>
</li>
</ul>
<h2 id="line-calibration">Line calibration</h2>
<p>Before starting line calibration, please make sure that map file and steering file is correctly set.
Also we need parameter file of prm/ppac/ch2ns.dat to convert TDC channel to ns unit. (already prepared I think)</p>

<div class="mermaid align-center">
graph LR;
    A[TDC channel] --&gt;|prm/ppac/ch2ns.dat| B[ns scale]
    B --&gt; |prm/ppac/dlppac.yaml|C{PPAC object}
</div>
<p>When you complete the setting except for <code>linecalib</code> parameters, let&rsquo;s start calibration!
We prepared two useful macros to calibrate dl-PPAC.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/run_PPACLineCalibration.C" target="_blank">macro/run_PPACLineCalibration.C</a> : Macro to actually execute</li>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/PPACLineCalibration.C" target="_blank">macro/PPACLineCalibration.C</a> : Macro that actually work</li>
</ul>
<p>First, we have to prepare the data with masks on the PPAC like following picture.
This mask has holes at 12.5 mm intervals.</p>
<figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_pic.jpg" width="300"/>
</figure>

<p>The position of the alpha line through the central hole can be calculated and the offset adjusted to achieve that position.
The geometry inside the PPAC is as follows.
I think all PPAC geometries used by CRIB are the same.</p>
<figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_geo.png" width="700"/>
</figure>

<p>The parameters required to calculate the coordinates of the position are as follows.</p>
<ul>
<li>PPAC ID</li>
<li>PPAC direction (first layer is X or Y)</li>
<li>alpha source offset X</li>
<li>alpha source offset Y</li>
<li>distance between the mask and alpha source</li>
<li>reflectx in the dlppac.yaml</li>
</ul>
<p>Using these parameters, the <code>macro/PPACLineCalibration.C</code> calculate the theoretical position and how much the parameters should be moved.</p>
<h2 id="example">Example</h2>
<p>Let&rsquo;s calibrate PPACa as an example.</p>
<ul>
<li>PPAC ID : #2</li>
<li>First layer is Y</li>
<li>alpha source offset X : 0.0 mm</li>
<li>alpha source offset Y : 2.2 mm</li>
<li>distance between the mask and alpha source : 92 mm</li>
<li>reflectx : 1 (have reflection)</li>
</ul>
<p>When we set the parameter like this files, the XY figure can be obtained.</p>

  
<div class="tab-panel" data-tab-group="b7db58c42725ed23666ff534fc07948f">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmppacdlppacyaml"
      class="tab-nav-button tab-panel-style cstyle initial active"
      onclick="switchTab('b7db58c42725ed23666ff534fc07948f','prmppacdlppacyaml')"
    >
      <span>
        <span class="tab-nav-hidden">prm/ppac/dlppac.yaml</span>
        <span class="tab-nav-text">prm/ppac/dlppac.yaml</span>
      </span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmppacdlppacyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TPPACParameter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># #2 PPAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">f3appac</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ns2mm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">delayoffset</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.29</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.18</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">linecalib</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">exchange</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reflectx</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geometry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">677.0</span><span class="w"> </span><span class="c"># user defined</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TXSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TYSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_before.png" width="600"/>
</figure>

<p>Then we can run the macro.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; acd
</span></span><span class="line"><span class="cl">&gt; vi macro/run_PPACLineCalibraion.C
</span></span><span class="line"><span class="cl"><span class="c1"># please set the parameters.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># instruction is written in this file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> .x macro/run_PPACLineCalibration.C
</span></span><span class="line"><span class="cl"><span class="c1"># -- snip --</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>cal<span class="o">)</span>  : <span class="o">(</span>-0, -0.51413<span class="o">)</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>data<span class="o">)</span> : <span class="o">(</span>0.890109, -0.274066<span class="o">)</span>
</span></span><span class="line"><span class="cl">difference             : <span class="o">(</span>0.890109, 0.240065<span class="o">)</span>
</span></span><span class="line"><span class="cl">move parameters        : <span class="o">(</span>-1.41737, 0.382269<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span></span></span></code></pre></div><p>And please input this value to the dlppac.yaml.</p>

  
<div class="tab-panel" data-tab-group="c59e3f514b1f71c2e1a7214a63005bd7">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmppacdlppacyaml"
      class="tab-nav-button tab-panel-style cstyle initial active"
      onclick="switchTab('c59e3f514b1f71c2e1a7214a63005bd7','prmppacdlppacyaml')"
    >
      <span>
        <span class="tab-nav-hidden">prm/ppac/dlppac.yaml</span>
        <span class="tab-nav-text">prm/ppac/dlppac.yaml</span>
      </span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmppacdlppacyaml"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l">art::TPPACParameter</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">Contents</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="c"># #2 PPAC</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">f3appac</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ns2mm</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">1.256</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">delayoffset</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.29</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.18</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">linecalib</span><span class="p">:</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">      </span>- -<span class="m">1.417</span><span class="w">
</span></span></span><span class="line hl"><span class="cl"><span class="w">      </span>- <span class="m">0.382</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">exchange</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">reflectx</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">geometry</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">0.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">677.0</span><span class="w"> </span><span class="c"># user defined</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TXSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">TYSumLimit</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- -<span class="m">800.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="m">2000.0</span></span></span></code></pre></div></div>
    </div>
  </div>
</div><p>Then you can complete the line calibration of the PPAC.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> .x macro/run_PPACLineCalibration.C
</span></span><span class="line"><span class="cl"><span class="c1"># -- snip --</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>cal<span class="o">)</span>  : <span class="o">(</span>-0, -0.51413<span class="o">)</span>
</span></span><span class="line"><span class="cl">center position <span class="o">(</span>data<span class="o">)</span> : <span class="o">(</span>-0.0191028, -0.571067<span class="o">)</span>
</span></span><span class="line"><span class="cl">difference             : <span class="o">(</span>-0.0191028, -0.0569366<span class="o">)</span> <span class="c1"># &lt;= almost zero!</span>
</span></span><span class="line"><span class="cl">move parameters        : <span class="o">(</span>0.0304184, -0.0906633<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">===================================================</span></span></span></code></pre></div><figure><img src="/artemis_crib/example/preparation/ppac_calibration/PPAC_after.png" width="600"/>
</figure>


<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Info</div>
  <div class="box-content">

<p>Because of the accuracy of the fitting, it does not make much sense to move the parameters any further.</p>
</div>
</div>
<p>The PPAC is then ready to be used by measuring how much offset the beamline axis has with respect to the delay-line axis at the position where the PPAC is actually placed, and putting this into the geometry parameters.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>H. Kumagai et al., Nucl. Inst. and Meth. A <strong>470</strong>, 562 (2001)&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="mwdc-calibration">MWDC calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="alpha-calibration">Alpha calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-23 by Kodai Okawa</span></span>
<p>This is the CRIB alpha source information.
(unit: MeV)</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>alpha-2</th>
<th>alpha-3</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>4.780</td>
<td>3.148</td>
</tr>
<tr>
<td></td>
<td>5.480</td>
<td>5.462</td>
</tr>
<tr>
<td></td>
<td>5.795</td>
<td>5.771</td>
</tr>
</tbody>
</table>
<h3 id="calibration-files">calibration files</h3>
<p>SSD calibration files need to be set at <code>prm/ssd/</code> directory.
The directory structure is like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ tree -L <span class="m">2</span> prm/ssd
</span></span><span class="line"><span class="cl">prm/ssd
</span></span><span class="line"><span class="cl">├── ch2MeV.dat <span class="c1"># test file</span>
</span></span><span class="line"><span class="cl">├── ch2ns.dat <span class="c1"># test file</span>
</span></span><span class="line"><span class="cl">├── f2ch2MeV.dat
</span></span><span class="line"><span class="cl">├── f2ch2MeV_raw.dat
</span></span><span class="line"><span class="cl">├── f2ch2ns.dat
</span></span><span class="line"><span class="cl">├── tel1
</span></span><span class="line"><span class="cl">│   ├── ch2MeV_dEX.dat
</span></span><span class="line"><span class="cl">│   ├── ch2MeV_dEX_raw.dat
</span></span><span class="line"><span class="cl">│   ├── ch2MeV_dEY.dat
</span></span><span class="line"><span class="cl">│   ├── ch2MeV_dEY_raw.dat
</span></span><span class="line"><span class="cl">│   ├── ch2MeV_E.dat
</span></span><span class="line"><span class="cl">│   ├── ch2MeV_E_raw.dat
</span></span><span class="line"><span class="cl">│   ├── ch2ns_dEX.dat
</span></span><span class="line"><span class="cl">│   ├── ch2ns_dEY.dat
</span></span><span class="line"><span class="cl">│   ├── ch2ns_E.dat
</span></span><span class="line"><span class="cl">│   └── tel_conf.yaml <span class="c1"># telescope configuration, explain later</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- snip --</span></span></code></pre></div><p>The <code>prm/ssd/ch2MeV.dat</code> and <code>prm/ssd/ch2ns.dat</code> are used for test, so in the beam time measurement, actually this files are not necessory.
And <code>prm/ssd/f2*</code> files are used for F2SSD calibration, and files in <code>prm/ssd/tel1/</code> directory are used for SSDs of a telescope.</p>
<p>The <code>ch2ns.dat</code> depends on TDC setting, so basically we don&rsquo;t have to care so muc
(Usually the setting (the value) is same with previous experiment.), so we have to prepare the <code>ch2MeV.dat</code> files!</p>

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Note</div>
  <div class="box-content">

<p>The file name need to be set like this example.
The loaded parameter file name is defined SSD steering file, and we don&rsquo;t want to change the SSD steering files so much, so please use such file names.</p>
</div>
</div>
<p>The &ldquo;ch2MeV.dat&rdquo; file format is like this:</p>

  
<div class="tab-panel" data-tab-group="e9b2651f11178e27db145bbfc2f86197">
  <div class="tab-nav">
    <div class="tab-nav-title">&#8203;</div>
    <button
      data-tab-item="prmssdf2ch2mevdat"
      class="tab-nav-button tab-panel-style cstyle initial active"
      onclick="switchTab('e9b2651f11178e27db145bbfc2f86197','prmssdf2ch2mevdat')"
    >
      <span>
        <span class="tab-nav-hidden">prm/ssd/f2ch2MeV.dat</span>
        <span class="tab-nav-text">prm/ssd/f2ch2MeV.dat</span>
      </span>
    </button>
  </div>
  <div class="tab-content-container">
    <div
      data-tab-item="prmssdf2ch2mevdat"
      class="tab-content tab-panel-style cstyle initial active">
      <div class="tab-content-text">

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># offset gain</span>
</span></span><span class="line"><span class="cl">1.7009  0.0173
</span></span><span class="line"><span class="cl">0.0 1.0 <span class="c1"># if there are some SSDs or strip SSD, you can add the line.</span></span></span></code></pre></div></div>
    </div>
  </div>
</div>
<span class="math align-center">$$ E~\mathrm{[MeV]} = \mathrm{offset} + \mathrm{gain} \times \mathrm{ch} $$</span><h3 id="usage">Usage</h3>
<p>We prepared useful macros to calibrate many SSDs.
Please check these for more information.</p>
<ul>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/AlphaCalibration.C" target="_blank">macro/AlphaCalibration.C</a></li>
<li><a href="https://github.com/okawak/artemis_crib/blob/main/macro/run_AlphaCalibration.C" target="_blank">macro/run_AlphaCalibraion.C</a></li>
</ul>
<p>It is sufficient to use the AlphaCalibration.C, but it is recommended to use the run_AlphaCalibration.C to keep a record of what arguments were used to calibrate.</p>
<p>After you prepared alpha calibration data and steering file (for example <code>steering/calibration.yaml</code>) to show raw data, you can use this macro.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ acd
</span></span><span class="line"><span class="cl">$ vi macro/run_AlphaCalibration.C
</span></span><span class="line"><span class="cl"><span class="c1"># please set the parameters.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># instraction is written in this file</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> .x macro/run_AlphaCalibration.C</span></span></code></pre></div><p>Then the parameter file that defined at the &ldquo;run_AlphaCalibration.C&rdquo; and calibration figures will be created automatically.</p>
<p>These are example of the figures;</p>
<ul>
<li>raw fitting figure (figure/calib/tel*/ch2MeV_*/raw/)</li>
</ul>
<figure><img src="/artemis_crib/example/preparation/alpha_calibration/ex_raw.png" width="600"/>
</figure>

<ul>
<li>calibration line and residual figure (figure/calib/tel*/ch2MeV_*/calibration/)</li>
</ul>
<figure><img src="/artemis_crib/example/preparation/alpha_calibration/ex_cal.png" width="600"/>
</figure>

<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ a
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>0<span class="o">]</span> add steering/hoge.yaml <span class="nv">NAME</span><span class="o">=</span>hoge <span class="nv">NUM</span><span class="o">=</span><span class="m">0000</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>1<span class="o">]</span> res
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>2<span class="o">]</span> fcd <span class="m">0</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>3<span class="o">]</span> zo
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>4<span class="o">]</span> tree-&gt;Draw<span class="o">(</span><span class="s2">&#34;...&#34;</span><span class="o">)</span> <span class="c1"># draw calibrated data</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>5<span class="o">]</span> gStyle-&gt;SetOptStat<span class="o">(</span>0<span class="o">)</span>
</span></span><span class="line"><span class="cl">artemis <span class="o">[</span>6<span class="o">]</span> sa</span></span></code></pre></div><figure><img src="/artemis_crib/example/preparation/alpha_calibration/ex_all_cal.png" width="600"/>
</figure>


            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="mux-calibration">MUX calibration</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="set-parameters">Set parameters</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-15 by Kodai Okawa</span></span>

            <footer class="footline">

            </footer>
          </article>

          <article class="default">
            <header class="headline">
            </header>
<h1 id="git">Git</h1>

<span class="badge cstyle default"><span class="badge-content">last modified: 2023-12-20 by Kodai Okawa</span></span>
<p>Analysis files for each experiment are managed using <code>git</code>.
This is so that they can be quickly restored if they are all lost for some reason.</p>
<p><code>Git</code> is a bit complicated and you can commit freely if you are knowledgeable, but if you are unfamiliar with it, you don&rsquo;t have to worry too much.
The main use is that if someone creates a useful file, it will be reflected for each user as well.</p>
<p>Here is a brief description of how to use it.</p>
<h2 id="directory-structure">Directory structure</h2>
<p>In the CRIB analysis PC, we used local repository.
The files related the repository is stored here.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&gt; <span class="nb">cd</span> ~
</span></span><span class="line"><span class="cl">&gt; tree -L <span class="m">1</span> repos/exp
</span></span><span class="line"><span class="cl">repos/exp
</span></span><span class="line"><span class="cl">├── he6p2024.git
</span></span><span class="line"><span class="cl">├── he6p.git
</span></span><span class="line"><span class="cl">└── o14a.git
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 2023/12/18 current status</span></span></span></code></pre></div>
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Warning</div>
  <div class="box-content">

<p>Note that if you delete the files in this directory, you will lose all backups.</p>
</div>
</div>
<h2 id="basic-commands">basic commands</h2>
<p>I will describe the most commonly used commands and how to resolve conflicts.</p>

            <footer class="footline">

            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="/artemis_crib/js/clipboard.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/perfect-scrollbar.min.js?1705744582" defer></script>
    <script>
      function useMathJax( config ){
        if( !Object.assign ){
          
          return;
        }
        window.MathJax = Object.assign( window.MathJax || {}, {
          loader: {
            load: ['[tex]/mhchem']
          },
          startup: {
            elements: [
              '.math'
            ]
          },
          tex: {
            inlineMath: [
              ['$', '$'], 
              ['\\(', '\\)']
            ]
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="/artemis_crib/js/d3/d3-color.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-dispatch.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-drag.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-ease.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-interpolate.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-selection.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-timer.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-transition.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/d3/d3-zoom.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/js-yaml.min.js?1705744582" defer></script>
    <script src="/artemis_crib/js/mermaid.min.js?1705744582" defer></script>
    <script>
      window.themeUseMermaid = JSON.parse("{}");
    </script>
    <script src="/artemis_crib/js/theme.js?1705744582" defer></script>
  </body>
</html>
