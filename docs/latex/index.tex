\label{index_md_doxy_main}%
\Hypertarget{index_md_doxy_main}%
 This is a detailed instruction about source code for developers. For installation and usage, please go to \href{../..}{\texttt{ this page}} created by Hugo.\hypertarget{index_autotoc_md4}{}\doxysection{Doxygen LISENSE}\label{index_autotoc_md4}
This pages are created by \href{https://www.doxygen.nl/}{\texttt{ doxygen}} and \href{https://jothepro.github.io/doxygen-awesome-css/}{\texttt{ Doxygen Awesome theme}}.

Copyright © 1997-\/2009 by Dimitri van Heesch.

Permission to use, copy, modify, and distribute this software and its documentation under the terms of the GNU General Public License is hereby granted. No representations are made about the suitability of this software for any purpose. It is provided \char`\"{}as is\char`\"{} without express or implied warranty. See the GNU General Public License for more details.

Documents produced by doxygen are derivative works derived from the input used in their production; they are not affected by this license.\hypertarget{index_autotoc_md5}{}\doxysection{名前空間}\label{index_autotoc_md5}
CRIB独自で開発したクラス、コードに対しては、cribという名前空間でラップして、artemis本体にあるコードと分けて管理できるようにしようと考えています。 例えば、{\ttfamily art\+::\+TTiming\+Charge\+Mapping\+Processor}はartemis自体にあるプロセッサから使用しており、{\ttfamily art\+::crib\+::\+TMUXMapping\+Processsor}はartemis\+\_\+cribで独自に 作成したプロセッサを使用している、といった形です。

もし、artemis自身にある同名、同じ役割のプロセッサを編集して使いたいと思った場合は、cribという名前空間を使用して追加してください。 また、今後も\+CRIB実験で使える汎用的なものを開発した場合もcribという名前空間を用いてプルリクエスト等を送ってください。\hypertarget{index_autotoc_md6}{}\doxysection{version管理}\label{index_autotoc_md6}
基本的には後方互換性はありません。 厳密にどういった変更をしたかなどのノートは残さないので、解析をするときは、その環境をそのまま使う方が良いと思います。 artemis自体、artemis-\/workdir (artemis\+\_\+crib)のバージョン、使っているenergy lossのツールのバージョン、 pythonのバージョン(py\+ROOTや便利スクリプトに使用、artemisの動作自体には使いません。)などを記録し、それをベースに解析を始めることをお勧めします。 同じ動作をすることが確認できてから、versionアップデートすると良いと思います。

pythonとartemis\+\_\+cribのバージョン管理をしやすくするためのversion管理を2024年8月のバージョンから導入することにしました。 versionの名前は、年.\+月.0 (major.\+minor.\+patch)としています。(CMake\+Lists.\+txtとpyproject.\+toml) ある程度動作確認が済んだら、gitのtagで分けていこうと思います。

以下動作未確認です。 gitのmainブランチを使用している場合は、{\ttfamily install/lib}の中にあるライブラリのシンボリックリンクを変えれば古いバージョンのものが使えるはず？

pythonのバージョンは{\ttfamily poetry}を用いて管理することにしました。 公式サイトからインストールするか、{\ttfamily pip install poetry}でインストールできます。 仮想環境(.venv)をそのディレクトリ内に作りたいときは、グローバルな設定で、


\begin{DoxyCode}{0}
\DoxyCodeLine{poetry config virtualenvs.in-\/project true}

\end{DoxyCode}


とすれば良いです。(ローカルな設定にもできます。) その後、art\+\_\+workdirで、


\begin{DoxyCode}{0}
\DoxyCodeLine{poetry install}

\end{DoxyCode}


で仮想環境の準備ができます。が、仮想環境がなくてもartemisは動作します。 うまくいかない場合は、lockファイルを消してからもう一度試してみてください。(うまくいくかはわからずです。) .venvをそのディレクトリ内に作成する場合は、artloginで自動的にその環境には入るように設定していますが、 そうでない場合、作成した仮想環境に入りたい場合は、


\begin{DoxyCode}{0}
\DoxyCodeLine{poetry shell}

\end{DoxyCode}


で有効化できます。\hypertarget{index_autotoc_md7}{}\doxysection{豆知識}\label{index_autotoc_md7}
日本語ですみません。ライブラリを整備している中で、気になったことをメモしておきます。 時間がある時に英語で整備し直すかもしれません。\hypertarget{index_autotoc_md8}{}\doxysubsection{1. //!の意味}\label{index_autotoc_md8}
プロセッサなどを作成していると、


\begin{DoxyCode}{0}
\DoxyCodeLine{TClonesArray **fInData; \textcolor{comment}{//!}}

\end{DoxyCode}


のようなコードに出くわすことがあるが、この最後の\char`\"{}//!\char`\"{}についてはよくわかっていなかった。 このおまじないのようなものを消すとエラーが出てくるし、調べても\+Doxygenのコメント形式だというような情報しか得られずよくわからないままだった。

最近\+Chat\+GPTに聞いてみると、初めて知ったことだが、\+ROOTの\+CINTや\+Clingインタープリタででポインタのポインタを\+I/\+Oシステムで使うことが難しく、 正しく解析できないというエラーで、//!をつけるとこの\+I/\+O処理から除外するように伝えることができるらしい。

難しくて完全には理解できていないが、ポインタのポインタを\+ROOTで扱うのは難しいから、//!をつけると\+ROOTの範疇から外すという意味合いになるということなのかな??? ROOTの作法ではなく、純粋な\+C++な知識だけが必要なものがいいなあと感じたり。。。\hypertarget{index_autotoc_md9}{}\doxysubsection{2. Class\+Defについて}\label{index_autotoc_md9}
Classを\+Dictionaryに登録するときに、\+Class\+Defを使うが、クラスメソッドをoverrideするときに\+Class\+Defを使うと長い警告文が出てくる。

調べてみると、\+Class\+Defにも種類があるようで、オーバーライドを使用する時には、\+Class\+Def\+Overrideというものが定義されているらしい。 \href{https://root-forum.cern.ch/t/classdef-variants/44736}{\texttt{ 情報}}の通り全てを列挙してみると、


\begin{DoxyItemize}
\item Class\+Def\+: Regular
\item Class\+Def\+Override\+: Use this one if your class definition use the c++ {\ttfamily override} keyword for virtual functions (If you use the regular Class\+Def, the compiler might warn that the function declared in the Class\+Def are missing the override keyword).
\item Class\+Def\+NV\+: Use if you class does not (and shoud not) have a virtual function table (i.\+e. no virtual function in the class and any of its base classes
\end{DoxyItemize}

ROOTには認識されるが、\+Dictionaryに登録しない場合は、


\begin{DoxyItemize}
\item Class\+Def\+Inline
\item Class\+Def\+Inline\+Override
\item Class\+Def\+Inline\+NV
\end{DoxyItemize}

という書き方もできるらしいが、一応まだexperimentalらしい。

通常は、\+Class\+Defか\+Class\+Def\+Overrideだけ使えば良さそうな感じかな?\hypertarget{index_autotoc_md10}{}\doxysubsection{Processorの仮想関数について}\label{index_autotoc_md10}
TProcessorを継承して新しいプロセッサを作成するときに、オーバーライドすることができる汎用的に使えそうな(自分が使っている)クラスメソッドの一覧のメモ。


\begin{DoxyCode}{0}
\DoxyCodeLine{\textcolor{comment}{// InitProcメソッドで呼ばれる}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Init (TEventCollection *) \{;\}}
\DoxyCodeLine{}
\DoxyCodeLine{\textcolor{comment}{// user defined member functions to process data}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} BeginOfRun() \{;\}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} EndOfRun() \{;\}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} PreProcess() \{;\}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Process() \{;\}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} PostProcess() \{;\}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} PreLoop() \{;\}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} PostLoop() \{;\}}
\DoxyCodeLine{\textcolor{keyword}{virtual} \textcolor{keywordtype}{void} Terminate() \{;\}}

\end{DoxyCode}


使うときは、virtual修飾子はつけなくてもよく(つけても良い)、overrideキーワードをつけておくとオーバーライドした関数であることがわかって良いかも。 この時は、\+Class\+Def\+Overrideを使う。 どのタイミングでこの関数が呼ばれるかという違いがあるが、\+Initと\+Processさえあれば行いたい処理は十分可能だと思う。

関数が呼ばれるタイミングは以下の通り。


\begin{DoxyItemize}
\item $<$add$>$ -\/$>$ Init
\item -\/$>$ $<$res$>$ -\/$>$ Begin\+Of\+Run -\/$>$ Pre\+Loop -\/$>$ (Pre\+Process -\/$>$ Process -\/$>$ Post\+Process) -\/$>$ (Pre\+Process -\/$>$ Process -\/$>$ Post\+Process) -\/$>$ ...
\item -\/$>$ Post\+Process -\/$>$ Post\+Loop -\/$>$ End\+Of\+Run
\item -\/$>$ $<$.q$>$ -\/$>$ Terminate
\end{DoxyItemize}

途中でsusを挟んだ場合は、


\begin{DoxyItemize}
\item Post\+Process) -\/$>$ $<$sus$>$ -\/$>$ Post\+Loop -\/$>$ $<$res$>$ -\/$>$ Pre\+Loop -\/$>$ (Pre\+Process -\/$>$ Process -\/$>$ Pre\+Process) -\/$>$ ...
\end{DoxyItemize}

といったような順番で呼ばれる。 